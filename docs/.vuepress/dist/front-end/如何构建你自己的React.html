<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>xieyezi</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css">
    <meta name="description" content="Hi,æˆ‘æ˜¯å†™å¤œå­">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <link rel="preload" href="/assets/css/0.styles.4e24aa18.css" as="style"><link rel="preload" href="/assets/js/app.c36f292d.js" as="script"><link rel="preload" href="/assets/js/3.38912bee.js" as="script"><link rel="preload" href="/assets/js/44.dbdc6ded.js" as="script"><link rel="prefetch" href="/assets/js/10.c91d9066.js"><link rel="prefetch" href="/assets/js/11.6b139ec4.js"><link rel="prefetch" href="/assets/js/12.0ea25bb5.js"><link rel="prefetch" href="/assets/js/13.3e7b7252.js"><link rel="prefetch" href="/assets/js/14.10112436.js"><link rel="prefetch" href="/assets/js/15.33357b2d.js"><link rel="prefetch" href="/assets/js/16.dc9f9442.js"><link rel="prefetch" href="/assets/js/17.6bc9ed1d.js"><link rel="prefetch" href="/assets/js/18.7b1bc5dc.js"><link rel="prefetch" href="/assets/js/19.42a109a9.js"><link rel="prefetch" href="/assets/js/20.70685a3f.js"><link rel="prefetch" href="/assets/js/21.9bab54df.js"><link rel="prefetch" href="/assets/js/22.b17e6623.js"><link rel="prefetch" href="/assets/js/23.3a3facfb.js"><link rel="prefetch" href="/assets/js/24.19d937c3.js"><link rel="prefetch" href="/assets/js/25.0b06dedb.js"><link rel="prefetch" href="/assets/js/26.9bc822c4.js"><link rel="prefetch" href="/assets/js/27.303be469.js"><link rel="prefetch" href="/assets/js/28.9ac8d307.js"><link rel="prefetch" href="/assets/js/29.6e44c233.js"><link rel="prefetch" href="/assets/js/30.fb8843a1.js"><link rel="prefetch" href="/assets/js/31.6568005d.js"><link rel="prefetch" href="/assets/js/32.7b683fa1.js"><link rel="prefetch" href="/assets/js/33.230a0d7e.js"><link rel="prefetch" href="/assets/js/34.c7680ca8.js"><link rel="prefetch" href="/assets/js/35.f24a5c09.js"><link rel="prefetch" href="/assets/js/36.ba6f3486.js"><link rel="prefetch" href="/assets/js/37.f3403e94.js"><link rel="prefetch" href="/assets/js/38.8a00ec08.js"><link rel="prefetch" href="/assets/js/39.19a27ac3.js"><link rel="prefetch" href="/assets/js/4.3ac81cc7.js"><link rel="prefetch" href="/assets/js/40.da7282a4.js"><link rel="prefetch" href="/assets/js/41.4affb23b.js"><link rel="prefetch" href="/assets/js/42.7c07af14.js"><link rel="prefetch" href="/assets/js/43.6052c1c6.js"><link rel="prefetch" href="/assets/js/45.49d542b0.js"><link rel="prefetch" href="/assets/js/46.b811ad06.js"><link rel="prefetch" href="/assets/js/47.4769375d.js"><link rel="prefetch" href="/assets/js/48.c99f41a8.js"><link rel="prefetch" href="/assets/js/49.8daa8807.js"><link rel="prefetch" href="/assets/js/5.60a3f304.js"><link rel="prefetch" href="/assets/js/50.9842bf5e.js"><link rel="prefetch" href="/assets/js/51.4ed4b25e.js"><link rel="prefetch" href="/assets/js/52.a49a6d56.js"><link rel="prefetch" href="/assets/js/53.e2b3a698.js"><link rel="prefetch" href="/assets/js/54.716afb19.js"><link rel="prefetch" href="/assets/js/55.f6430acf.js"><link rel="prefetch" href="/assets/js/56.22648000.js"><link rel="prefetch" href="/assets/js/57.83b8aaac.js"><link rel="prefetch" href="/assets/js/58.5e6c8143.js"><link rel="prefetch" href="/assets/js/59.be862437.js"><link rel="prefetch" href="/assets/js/6.b2b898e7.js"><link rel="prefetch" href="/assets/js/60.a912d638.js"><link rel="prefetch" href="/assets/js/61.87807b1c.js"><link rel="prefetch" href="/assets/js/62.808bc71e.js"><link rel="prefetch" href="/assets/js/63.dcafe2c9.js"><link rel="prefetch" href="/assets/js/64.ade44fde.js"><link rel="prefetch" href="/assets/js/7.7d416c3b.js"><link rel="prefetch" href="/assets/js/8.73a2e700.js"><link rel="prefetch" href="/assets/js/9.bf16d7d0.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.22a05a37.js">
    <link rel="stylesheet" href="/assets/css/0.styles.4e24aa18.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="ant-row"><div class="sidebar-button"><i aria-label="icon: bars" class="anticon anticon-bars"><svg viewBox="0 0 1024 1024" focusable="false" data-icon="bars" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0z"></path></svg></i> <span></span></div> <div class="ant-col ant-col-xs-24 ant-col-sm-24 ant-col-md-6 ant-col-lg-5 ant-col-xl-5 ant-col-xxl-4"><a href="/" class="router-link-active home-link"><img src="/logo.png" alt="xieyezi" class="logo"> <span class="site-name">xieyezi</span></a> <div class="search-box mobile-search"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div> <div class="ant-col ant-col-xs-0 ant-col-sm-0 ant-col-md-18 ant-col-lg-19 ant-col-xl-19 ant-col-xxl-20"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><ul role="menu" id="nav" class="ant-menu ant-menu-horizontal ant-menu-root ant-menu-light"><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>Â·Â·Â·</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/" class="router-link-active">
          é¦–é¡µ
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>Â·Â·Â·</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item ant-menu-item-selected"><a href="/front-end/" class="router-link-active">
          ğŸƒå‰ç«¯
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>Â·Â·Â·</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/notes/">
          ğŸ“’ç¬”è®°
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>Â·Â·Â·</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          ğŸŒ¿Flutter
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>Â·Â·Â·</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          ğŸŒ±å…¶ä»–
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>Â·Â·Â·</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          ğŸŒˆè”ç³»
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="visibility:hidden;position:absolute;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>Â·Â·Â·</span><i class="ant-menu-submenu-arrow"></i></div></li></ul> <a href="https://github.com/xieyezi/vuepress-blog" target="_blank" rel="noopener noreferrer" class="repo-link"><i aria-label="icon: github" class="anticon anticon-github"><svg viewBox="64 64 896 896" focusable="false" data-icon="github" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0 1 38.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"></path></svg></i></a></nav></div></div> <!----></header> <aside class="sidebar"><!----> <ul class="sidebar-links"><li><a href="/front-end/" aria-current="page" title="å‰ç«¯" class="sidebar-link">å‰ç«¯</a></li><li><a href="/front-end/vuex5è¦è§£å†³å“ªäº›é—®é¢˜.html" title="vuex5è¦è§£å†³å“ªäº›é—®é¢˜" class="sidebar-link">vuex5è¦è§£å†³å“ªäº›é—®é¢˜</a></li><li><a href="/front-end/å¦‚ä½•æ„å»ºä½ è‡ªå·±çš„React.html" title="å¦‚ä½•æ„å»ºä½ è‡ªå·±çš„React" class="active sidebar-link">å¦‚ä½•æ„å»ºä½ è‡ªå·±çš„React</a></li><li><a href="/front-end/å•†å“å¤šè§„æ ¼é€‰æ‹©-skuç®—æ³•.html" title="å•†å“å¤šè§„æ ¼é€‰æ‹©-skuç®—æ³•" class="sidebar-link">å•†å“å¤šè§„æ ¼é€‰æ‹©-skuç®—æ³•</a></li><li><a href="/front-end/reactå…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹.html" title="react å…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹(ä¸‡å­—æ€»ç»“)" class="sidebar-link">react å…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹(ä¸‡å­—æ€»ç»“)</a></li><li><a href="/front-end/Vue3å†™ä¸€ä¸ªç–«æƒ…æŸ¥è¯¢å°å·¥å…·.html" title="Vue3å†™ä¸€ä¸ªç–«æƒ…æŸ¥è¯¢å°å·¥å…·" class="sidebar-link">Vue3å†™ä¸€ä¸ªç–«æƒ…æŸ¥è¯¢å°å·¥å…·</a></li><li><a href="/front-end/2019nCoVç–«æƒ…åœ°å›¾.html" title="2019nCoVç–«æƒ…åœ°å›¾" class="sidebar-link">2019nCoVç–«æƒ…åœ°å›¾</a></li><li><a href="/front-end/javascriptåŸå‹ä¸åŸå‹é“¾çš„æ·±åº¦è§£æ.html" title="javascriptåŸå‹ä¸åŸå‹é“¾çš„æ·±åº¦è§£æ" class="sidebar-link">javascriptåŸå‹ä¸åŸå‹é“¾çš„æ·±åº¦è§£æ</a></li><li><a href="/front-end/ReactåŸºç¡€çŸ¥è¯†.html" title="ReactåŸºç¡€çŸ¥è¯†" class="sidebar-link">ReactåŸºç¡€çŸ¥è¯†</a></li><li><a href="/front-end/Vue.$nextTickè§£æ.html" title="Vue.$nextTickè§£æ" class="sidebar-link">Vue.$nextTickè§£æ</a></li><li><a href="/front-end/ä¸€äº›è¯­æ³•å—.html" title="ä¸€äº›è¯­æ³•å—" class="sidebar-link">ä¸€äº›è¯­æ³•å—</a></li><li><a href="/front-end/é˜²æŠ–å’ŒèŠ‚æµ.html" title="é˜²æŠ–å’ŒèŠ‚æµ" class="sidebar-link">é˜²æŠ–å’ŒèŠ‚æµ</a></li><li><a href="/front-end/import å’Œ require çš„åŒºåˆ«.html" title="import å’Œ require çš„åŒºåˆ«" class="sidebar-link">import å’Œ require çš„åŒºåˆ«</a></li><li><a href="/front-end/WIndowsæ­å»ºæœ€å®Œç¾çš„VS codeå¼€å‘å¹³å°.html" title="WIndowsæ­å»ºæœ€å®Œç¾çš„VS codeå¼€å‘å¹³å°" class="sidebar-link">WIndowsæ­å»ºæœ€å®Œç¾çš„VS codeå¼€å‘å¹³å°</a></li><li><a href="/front-end/hexo+github+netlifyæ­å»ºä¸ªäººåšå®¢.html" title="hexo+github+netlifyæ­å»ºä¸ªäººåšå®¢" class="sidebar-link">hexo+github+netlifyæ­å»ºä¸ªäººåšå®¢</a></li><li><a href="/front-end/VueXçš„ç›¸å…³ä½¿ç”¨.html" title="VueXçš„ç›¸å…³ä½¿ç”¨" class="sidebar-link">VueXçš„ç›¸å…³ä½¿ç”¨</a></li><li><a href="/front-end/Vueä½¿ç”¨axiosçš„getå’Œpostè¯·æ±‚.html" title="Vueä½¿ç”¨axiosçš„getå’Œpostè¯·æ±‚" class="sidebar-link">Vueä½¿ç”¨axiosçš„getå’Œpostè¯·æ±‚</a></li><li><a href="/front-end/Vueå¤šä¸ªç»„ä»¶æ˜ å°„åˆ°åŒä¸€ä¸ªç»„ä»¶,é¡µé¢ä¸åˆ·æ–°ï¼Ÿ.html" title="Vueå¤šä¸ªç»„ä»¶æ˜ å°„åˆ°åŒä¸€ä¸ªç»„ä»¶,é¡µé¢ä¸åˆ·æ–°ï¼Ÿ" class="sidebar-link">Vueå¤šä¸ªç»„ä»¶æ˜ å°„åˆ°åŒä¸€ä¸ªç»„ä»¶,é¡µé¢ä¸åˆ·æ–°ï¼Ÿ</a></li><li><a href="/front-end/Tomcatçš„é…ç½®åŸŸåè®¿é—®.html" title="Tomcatçš„é…ç½®åŸŸåè®¿é—®" class="sidebar-link">Tomcatçš„é…ç½®åŸŸåè®¿é—®</a></li><li><a href="/front-end/Vue Cli3.0è¯·æ±‚æœ¬åœ°æ¨¡æ‹Ÿæ•°æ®.html" title="Vue Cli3.0è¯·æ±‚æœ¬åœ°æ¨¡æ‹Ÿæ•°æ®" class="sidebar-link">Vue Cli3.0è¯·æ±‚æœ¬åœ°æ¨¡æ‹Ÿæ•°æ®</a></li><li><a href="/front-end/Vue-cli 3.0è§£å†³è·¨åŸŸé—®é¢˜.html" title="Vue-cli 3.0è§£å†³è·¨åŸŸé—®é¢˜" class="sidebar-link">Vue-cli 3.0è§£å†³è·¨åŸŸé—®é¢˜</a></li><li><a href="/front-end/Vue-cli3.0+Hbuilderæ‰“åŒ…App.html" title="Vue-cli3.0+Hbuilderæ‰“åŒ…App" class="sidebar-link">Vue-cli3.0+Hbuilderæ‰“åŒ…App</a></li><li><a href="/front-end/Vueå¼€å‘ç¯å¢ƒçš„æ­å»º.html" title="Vueå¼€å‘ç¯å¢ƒçš„æ­å»º" class="sidebar-link">Vueå¼€å‘ç¯å¢ƒçš„æ­å»º</a></li><li><a href="/front-end/Vueæ’æ§½ä¸ç¼“å­˜.html" title="Vueæ’æ§½ä¸ç¼“å­˜" class="sidebar-link">Vueæ’æ§½ä¸ç¼“å­˜</a></li><li><a href="/front-end/Vueç»„ä»¶.html" title="Vueç»„ä»¶" class="sidebar-link">Vueç»„ä»¶</a></li><li><a href="/front-end/Vueç»„ä»¶åº“iViewçš„ä½¿ç”¨.html" title="Vueç»„ä»¶åº“iViewçš„ä½¿ç”¨" class="sidebar-link">Vueç»„ä»¶åº“iViewçš„ä½¿ç”¨</a></li><li><a href="/front-end/Vueè·¯ç”±çš„åŸºæœ¬åŠ è½½.html" title="Vueè·¯ç”±çš„åŸºæœ¬åŠ è½½" class="sidebar-link">Vueè·¯ç”±çš„åŸºæœ¬åŠ è½½</a></li><li><a href="/front-end/Vueè¿‡æ¸¡ä¸åŠ¨ç”».html" title="Vueè¿‡æ¸¡ä¸åŠ¨ç”»" class="sidebar-link">Vueè¿‡æ¸¡ä¸åŠ¨ç”»</a></li><li><a href="/front-end/better-scrollæ’ä»¶åˆå§‹åŒ–åæ²¡æœ‰æ•ˆæœ.html" title="better-scrollæ’ä»¶åˆå§‹åŒ–åæ²¡æœ‰æ•ˆæœ" class="sidebar-link">better-scrollæ’ä»¶åˆå§‹åŒ–åæ²¡æœ‰æ•ˆæœ</a></li><li><a href="/front-end/callå’Œapplyçš„åŒºåˆ«.html" title="callå’Œapplyçš„åŒºåˆ«" class="sidebar-link">callå’Œapplyçš„åŒºåˆ«</a></li><li><a href="/front-end/cssè¶…å‡ºéƒ¨åˆ†æ˜¾ç¤ºçœç•¥å·.html" title="cssè¶…å‡ºéƒ¨åˆ†æ˜¾ç¤ºçœç•¥å·" class="sidebar-link">cssè¶…å‡ºéƒ¨åˆ†æ˜¾ç¤ºçœç•¥å·</a></li><li><a href="/front-end/nginxç»™tomcaté…ç½®åå‘ä»£ç†.html" title="nginxç»™tomcaté…ç½®åå‘ä»£ç†" class="sidebar-link">nginxç»™tomcaté…ç½®åå‘ä»£ç†</a></li><li><a href="/front-end/promiseçš„è¿ç»­è°ƒç”¨é—®é¢˜.html" title="promiseçš„è¿ç»­è°ƒç”¨é—®é¢˜" class="sidebar-link">promiseçš„è¿ç»­è°ƒç”¨é—®é¢˜</a></li><li><a href="/front-end/vue-amapçš„bug -Cannot read property 'Ac' of null.html" title="vue-amapçš„bug -Cannot read property 'Ac' of null" class="sidebar-link">vue-amapçš„bug -Cannot read property 'Ac' of null</a></li><li><a href="/front-end/å­ç»„ä»¶å’Œçˆ¶ç»„ä»¶é€šä¿¡.html" title="å­ç»„ä»¶å’Œçˆ¶ç»„ä»¶é€šä¿¡" class="sidebar-link">å­ç»„ä»¶å’Œçˆ¶ç»„ä»¶é€šä¿¡</a></li><li><a href="/front-end/è§£å†³ç§»åŠ¨ç«¯300mså»¶è¿Ÿç‚¹å‡»çš„é—®é¢˜.html" title="è§£å†³ç§»åŠ¨ç«¯300mså»¶è¿Ÿç‚¹å‡»çš„é—®é¢˜" class="sidebar-link">è§£å†³ç§»åŠ¨ç«¯300mså»¶è¿Ÿç‚¹å‡»çš„é—®é¢˜</a></li><li><a href="/front-end/è®°ä¸€æ¬¡è‡ªå·±å°è£…NPMåŒ…çš„ç»å†.html" title="è®°ä¸€æ¬¡è‡ªå·±å°è£…NPMåŒ…çš„ç»å†" class="sidebar-link">è®°ä¸€æ¬¡è‡ªå·±å°è£…NPMåŒ…çš„ç»å†</a></li><li><a href="/front-end/Es6çš„å­¦ä¹ ç¬”è®°1.html" title="Es6çš„å­¦ä¹ ç¬”è®°1" class="sidebar-link">Es6çš„å­¦ä¹ ç¬”è®°1</a></li><li><a href="/front-end/Es6çš„å­¦ä¹ ç¬”è®°2.html" title="Es6çš„å­¦ä¹ ç¬”è®°2" class="sidebar-link">Es6çš„å­¦ä¹ ç¬”è®°2</a></li><li><a href="/front-end/Gulpçš„åŸºæœ¬ä½¿ç”¨.html" title="Gulpçš„åŸºæœ¬ä½¿ç”¨" class="sidebar-link">Gulpçš„åŸºæœ¬ä½¿ç”¨</a></li></ul></aside> <main class="page"> <div class="theme-antdocs-content content__default"><p>ç°åœ¨ï¼Œæˆ‘ä»¬å°†è¦éµå¾ª React ä»£ç çš„ä½“ç³»ç»“æ„ï¼Œä¸€æ­¥æ­¥çš„å®ç°æˆ‘ä»¬è‡ªå·±çš„ React ç‰ˆæœ¬ã€‚ä½†æ˜¯æœ¬æ¬¡å¹¶ä¸ä¼šå°†ä¼˜åŒ–ä»¥åŠéå¿…è¦çš„ç‰¹æ€§åŠ å…¥è¿›æ¥ã€‚
å¦‚æœä½ æœ‰é˜…è¯»è¿‡æˆ‘ä»¥å‰ä»»ä½•ä¸€ç¯‡ æ„å»ºä½ è‡ªå·±çš„ React æ–‡ç« ï¼Œè¿™æ¬¡çš„ä¸åŒç‚¹åœ¨äºï¼Œæœ¬æ¬¡æ„å»ºæ˜¯åŸºäº React çš„16.8ç‰ˆæœ¬ï¼Œæ‰€ä»¥è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ hooks æ¥æ›¿ä»£ classã€‚
ä½ å¯ä»¥åœ¨ä¹‹å‰çš„æ–‡ç« æˆ–è€… Didact ä»£ç ä»“åº“ä¸­äº†è§£ä¹‹å‰æ„å»ºçš„ reactã€‚è€Œä¸”è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªå†…å®¹ç›¸åŒçš„è§†é¢‘ã€‚ä½†æ˜¯æœ¬ç¯‡æ–‡ç« åŒ…å«å®Œæ•´çš„æ„å»ºè¿‡ç¨‹ï¼Œå¹¶ä¸ä¼šä¾èµ–äºä¹‹å‰çš„å†…å®¹ã€‚
é‚£ä»å¤´å¼€å§‹ï¼Œä¸‹é¢æ˜¯éœ€è¦æˆ‘ä»¬åŠ å…¥åˆ°æœ¬æ¬¡ react æ„å»ºä¸­çš„ç‰¹æ€§ã€‚</p> <ul><li>æ­¥éª¤ä¸€ï¼šcreateElement å‡½æ•°</li> <li>æ­¥éª¤äºŒï¼šrender å‡½æ•°</li> <li>æ­¥éª¤ä¸‰ï¼šConcurrent æ¨¡å¼ï¼ˆäº†è§£æ›´å¤šï¼‰</li> <li>æ­¥éª¤å››ï¼šFibersï¼ˆäº†è§£æ›´å¤šï¼‰</li> <li>æ­¥éª¤äº”ï¼šæ¸²æŸ“å’Œæäº¤</li> <li>æ­¥éª¤å…­ï¼šReconciliationï¼ˆäº†è§£æ›´å¤šï¼‰</li> <li>æ­¥éª¤ä¸ƒï¼šå‡½æ•°ç»„ä»¶</li> <li>æ­¥éª¤å…«ï¼šHooksï¼ˆäº†è§£æ›´å¤šï¼‰</li></ul> <p>å¼€å§‹ä¹‹å‰ï¼šå›é¡¾
é¦–å…ˆæˆ‘ä»¬å›é¡¾ä¸€äº›åŸºæœ¬çš„æ¦‚å¿µã€‚å¦‚æœä½ å·²ç»å¯¹ Reactã€JSX å’Œ DOM å…ƒç´ çš„åŸç†æœ‰ä¸€ä¸ªå¾ˆå¥½çš„äº†è§£ï¼Œé‚£ä¹ˆå¯ä»¥è·³è¿‡è¿™ä¸€æ­¥ã€‚
æˆ‘ä»¬ä½¿ç”¨å¦‚ä¸‹ React åº”ç”¨æ¥ä½œä¸ºä¾‹å­ï¼Œè¿™ä¸ªä¾‹å­åªéœ€è¦ä¸‰è¡Œä»£ç ã€‚ç¬¬ä¸€è¡Œåˆ›å»ºäº†ä¸€ä¸ª React å…ƒç´ ã€‚æ¥ä¸‹æ¥ä» DOM ä¸­è·å–ä¸€ä¸ªèŠ‚ç‚¹ã€‚æœ€åå°† React å…ƒç´ æ¸²æŸ“åˆ°è·å–çš„ DOM èŠ‚ç‚¹ä¸­ã€‚</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> element <span class="token operator">=</span> <span class="token operator">&lt;</span>h1 title<span class="token operator">=</span><span class="token string">&quot;foo&quot;</span><span class="token operator">&gt;</span>Hello<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
<span class="token keyword">const</span> container <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> container<span class="token punctuation">)</span>
</code></pre></div><p>ä½¿ç”¨åŸç”Ÿ JS æ›¿æ¢æ‰æ‰€æœ‰çš„ React ä»£ç ã€‚
åœ¨ç¬¬ä¸€è¡Œä¸­ä½¿ç”¨ JSX åˆ›å»ºäº†ä¸€ä¸ªå…ƒç´ ã€‚ä½† JSX å¹¶ä¸æ˜¯æœ‰æ•ˆçš„ Javascript ä»£ç ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨åŸç”Ÿ JS æ¥æ›¿æ¢æ‰ã€‚
JSX å¯ä»¥è¢« Babel ç­‰ç¼–è¯‘å·¥å…·è½¬æ¢ä¸º JSã€‚è¿™ä¸ªè½¬æ¢è¿‡ç¨‹é€šå¸¸å¾ˆç®€å•ï¼šè°ƒç”¨ createElement å‡½æ•°æ›¿æ¢æ‰æ ‡ç­¾å†…çš„ä»£ç ï¼Œå°†æ ‡ç­¾åã€props å±æ€§å’Œ childenå…ƒç´  ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// è½¬æ¢å‰</span>
<span class="token keyword">const</span> element <span class="token operator">=</span> <span class="token operator">&lt;</span>h1 title<span class="token operator">=</span><span class="token string">&quot;foo&quot;</span><span class="token operator">&gt;</span>Hello<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
<span class="token comment">// è½¬æ¢å</span>
<span class="token keyword">const</span> element <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>
  <span class="token string">&quot;h1&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> title<span class="token operator">:</span> <span class="token string">&quot;foo&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">&quot;Hello&quot;</span>
<span class="token punctuation">)</span>
</code></pre></div><p>React.createElement  æ ¹æ®å‚æ•°åˆ›å»ºäº†ä¸€ä¸ªå¯¹è±¡ã€‚é™¤äº†ä¸€äº›æ ¡éªŒï¼Œè¿™å°±æ˜¯è¿™ä¸ªå‡½æ•°åšçš„å…¨éƒ¨å·¥ä½œã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨å®ƒçš„è¾“å‡ºæ¥æ›¿æ¢æ‰å‡½æ•°è°ƒç”¨ã€‚</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// è½¬æ¢å‰</span>
<span class="token keyword">const</span> element <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>
 <span class="token string">&quot;h1&quot;</span><span class="token punctuation">,</span>
 <span class="token punctuation">{</span> title<span class="token operator">:</span> <span class="token string">&quot;foo&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token string">&quot;Hello&quot;</span>
<span class="token punctuation">)</span>
<span class="token comment">// è½¬æ¢å</span>
<span class="token keyword">const</span> element <span class="token operator">=</span> <span class="token punctuation">{</span>
 <span class="token keyword">type</span><span class="token operator">:</span> <span class="token string">&quot;h1&quot;</span><span class="token punctuation">,</span>
 props<span class="token operator">:</span> <span class="token punctuation">{</span>
   title<span class="token operator">:</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span>
   children<span class="token operator">:</span> <span class="token string">&quot;Hello&quot;</span><span class="token punctuation">,</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>è¿™å°±æ˜¯ä¸€ä¸ª React å…ƒç´ çš„æœ¬è´¨ï¼Œä¸€ä¸ªåŒ…å«ä¸¤ä¸ªå±æ€§çš„å¯¹è±¡ï¼štype å’Œ propsï¼ˆå½“ç„¶ï¼Œè¿˜æœ‰æ›´å¤šå±æ€§ï¼Œä½†æ˜¯æˆ‘ä»¬åªå…³æ³¨è¿™ä¸¤ä¸ªï¼‰ã€‚
type æ˜¯ä¸€ä¸ªæ ‡è¯†æˆ‘ä»¬æƒ³åˆ›å»ºçš„ DOM å…ƒç´ ç±»å‹çš„å­—ç¬¦ä¸²ï¼Œå½“ä½ æƒ³åˆ›å»ºä¸€ä¸ª HTML å…ƒç´ æ—¶ï¼Œtypeä½œä¸ºä¸€ä¸ª æ ‡ç­¾å å‚æ•°ä¼ å…¥åˆ° document.createElemnt å‡½æ•°ä¸­ã€‚æˆ‘ä»¬å°†åœ¨ç¬¬ä¸ƒæ­¥ä¸­ä½¿ç”¨å®ƒã€‚
props æ˜¯ä¸€ä¸ªåŒ…å«æ‰€æœ‰ JSX å±æ€§çš„å¯¹è±¡ï¼Œå®ƒè¿˜æœ‰ä¸€ä¸ªç‰¹æ®Šçš„å±æ€§ï¼šchildrenã€‚
children åœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä½†æ˜¯å®ƒé€šå¸¸éƒ½æ˜¯ä¸€ä¸ªæœ‰å¾ˆå¤šå…ƒç´ çš„æ•°ç»„ã€‚æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ è¿˜å¯èƒ½æœ‰è‡ªå·±çš„å­å…ƒç´ ï¼Œæ‰€ä»¥æœ€åæ‰€æœ‰çš„å…ƒç´ ä¼šç»„æˆä¸€ä¸ªæ ‘çŠ¶ç»“æ„ã€‚
æˆ‘ä»¬éœ€è¦æ›¿æ¢çš„å¦å¤–ä¸€éƒ¨åˆ†æ˜¯ ReactDom.render å‡½æ•°çš„è°ƒç”¨ã€‚
render æ˜¯ React æ”¹å˜ DOM çš„åœ°æ–¹ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬è‡ªå·±æ¥å®ç° DOM çš„æ›´æ–°ã€‚
ç¬¬ä¸€æ­¥æˆ‘ä»¬æ ¹æ®ä¾‹å­ä¸­çš„å…ƒç´ ç±»å‹ h1 åˆ›å»ºä¸€ä¸ª DOM èŠ‚ç‚¹ã€‚
ä¹‹åæˆ‘ä»¬å°†æ‰€æœ‰å…ƒç´  props ä¸­çš„å±æ€§æ·»åŠ åˆ°è¿™ä¸ª DOM èŠ‚ç‚¹ä¸­ã€‚è¿™é‡Œéœ€è¦æ·»åŠ çš„åªæœ‰ä¸€ä¸ª title å±æ€§ã€‚
*ï¼ˆä¸ºäº†é¿å…å¤§å®¶äº§ç”Ÿç–‘æƒ‘ï¼Œæˆ‘ä½¿ç”¨â€œå…ƒç´ â€ä»£æŒ‡Reactå…ƒç´ ï¼Œä½¿ç”¨â€œèŠ‚ç‚¹â€ä»£æŒ‡ DOM å…ƒç´ ã€‚ï¼‰
æ¥ä¸‹æ¥æˆ‘ä»¬ä¸º children åˆ›å»ºèŠ‚ç‚¹ã€‚è¿™é‡Œæˆ‘ä»¬åªæœ‰ä¸€ä¸ªå­—ç¬¦ä¸²ä½œä¸º childrenï¼Œæ‰€ä»¥åªéœ€è¦åˆ›å»ºä¸€ä¸ªæ–‡æœ¬èŠ‚ç‚¹ã€‚
ä½¿ç”¨ textNode è€Œä¸æ˜¯è®¾ç½® innerHTML æ˜¯å› ä¸ºä¹‹åè¿™æ ·å¯ä»¥ä»¥ç›¸åŒçš„æ–¹å¼å»åˆ›å»ºå…¶ä»–å…ƒç´ ã€‚æ³¨æ„æˆ‘ä»¬æ˜¯æ€ä¹ˆè®¾ç½® nodeValue çš„ï¼Œå°±åƒæˆ‘ä»¬è®¾ç½® h1 çš„ title ä¸€æ ·ï¼Œè¿™å°±å¥½åƒå­—ç¬¦ä¸²æœ‰äº† props:{nodeValue:&quot;hello&quot;}ã€‚
æœ€åï¼Œæˆ‘ä»¬å°† æ–‡æœ¬èŠ‚ç‚¹ æ·»åŠ åˆ° h1èŠ‚ç‚¹ ä¸­ï¼Œç„¶åå°† h1èŠ‚ç‚¹ æ·»åŠ åˆ°ä» DOM ä¸­è·å–åˆ°çš„ container èŠ‚ç‚¹ä¸­ã€‚
ç°åœ¨æˆ‘ä»¬çš„åº”ç”¨å’Œä¹‹å‰ä¸€æ ·ï¼Œä½†æ˜¯æ²¡æœ‰ä½¿ç”¨ React æ¥æ„å»ºã€‚</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> element <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">type</span><span class="token operator">:</span> <span class="token string">&quot;h1&quot;</span><span class="token punctuation">,</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    title<span class="token operator">:</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span>
    children<span class="token operator">:</span> <span class="token string">&quot;Hello&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
â€‹
<span class="token keyword">const</span> container <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span>
â€‹
<span class="token keyword">const</span> node <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span><span class="token keyword">type</span><span class="token punctuation">)</span>
node<span class="token punctuation">[</span><span class="token string">&quot;title&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> element<span class="token punctuation">.</span>props<span class="token punctuation">.</span>title
â€‹
<span class="token keyword">const</span> text <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
text<span class="token punctuation">[</span><span class="token string">&quot;nodeValue&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> element<span class="token punctuation">.</span>props<span class="token punctuation">.</span>children
â€‹
node<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>
container<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>
</code></pre></div><p>ç¬¬ä¸€æ­¥ createElement å‡½æ•°
è®©æˆ‘ä»¬ä»¥å¦å¤–ä¸€ä¸ªåº”ç”¨å¼€å§‹ï¼Œè¿™æ¬¡æˆ‘ä»¬å°†ä¼šæŠŠ React ä»£ç æ›¿æ¢ä¸ºæˆ‘ä»¬è‡ªå·±å®ç°çš„ React ç‰ˆæœ¬ã€‚</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> element <span class="token operator">=</span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;foo&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>a<span class="token operator">&gt;</span>bar<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>b <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">)</span>
<span class="token keyword">const</span> container <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> container<span class="token punctuation">)</span>
</code></pre></div><p>ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬æ¥å®ç°è‡ªå·±çš„ createElementã€‚
è®©æˆ‘ä»¬å°† JSX è½¬æ¢ä¸º JSï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ° *createElement å‡½æ•°æ˜¯å¦‚ä½•è¢«è°ƒç”¨ã€‚</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> element <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>
 <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span>
 <span class="token punctuation">{</span>id<span class="token operator">:</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
 React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token string">&quot;bar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
<span class="token keyword">const</span> container <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> container<span class="token punctuation">)</span>
</code></pre></div><p>æ­£å¦‚æˆ‘ä»¬åœ¨ä¸Šä¸€æ­¥çœ‹åˆ°çš„ï¼Œå…ƒç´ å°±æ˜¯ä¸€ä¸ªåŒ…å« type å’Œ props å±æ€§çš„å¯¹è±¡ã€‚æˆ‘ä»¬çš„å‡½æ•°å”¯ä¸€è¦åšçš„å°±æ˜¯å»åˆ›å»ºä¸€ä¸ªè¿™æ ·çš„å¯¹è±¡ã€‚</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token keyword">type</span><span class="token punctuation">,</span> props<span class="token punctuation">,</span> <span class="token operator">...</span>children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token keyword">type</span><span class="token punctuation">,</span>
    props<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token operator">...</span>props<span class="token punctuation">,</span>
      children<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æˆ‘ä»¬ä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦æ¥å¤„ç† propsï¼Œä½¿ç”¨restå‚æ•°è¯­æ³•æ¥å¤„ç† *childrenï¼Œè¿™æ · children å±æ€§å°†å§‹ç»ˆæ˜¯ä¸€ä¸ªæ•°ç»„ã€‚
ä¸¾ä¸ªä¾‹å­ï¼ŒcreateElement(&quot;div&quot;) è¿”å›å¦‚ä¸‹ï¼š</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;props&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;children&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>createElement(&quot;div&quot;,null,a) è¿”å›å¦‚ä¸‹ï¼š</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;props&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;children&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>createElement(&quot;div&quot;,null,a,b) è¿”å›å¦‚ä¸‹ï¼š</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;props&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;children&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span>b<span class="token punctuation">]</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>children æ•°ç»„è¿˜å¯ä»¥åŒ…å«åƒå­—ç¬¦ä¸²æˆ–è€…æ•°å­—è¿™æ ·çš„åŸºæœ¬ç±»å‹æ•°æ®ã€‚æ‰€ä»¥æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç‰¹æ®Šçš„ç±»å‹ï¼šTEXT_ELEMENT æ¥å°†æ‰€æœ‰ä¸æ˜¯å¯¹è±¡çš„å€¼åŒ…è£…åœ¨è‡ªå·±çš„å…ƒç´ ä¸­ã€‚
ï¼ˆReact ä¸ä¼šåƒæˆ‘ä»¬è¿™æ ·åŒ…è£…åŸºæœ¬ç±»å‹å€¼ï¼Œåœ¨æ²¡æœ‰å­å…ƒç´ çš„æƒ…å†µä¸‹åˆ›å»ºç©ºæ•°ç»„ã€‚æˆ‘ä»¬è¿™æ ·åšæ˜¯ä¸ºäº†ä»£ç çš„ç®€æ´ï¼Œå¯¹äºæˆ‘ä»¬çš„åº“ï¼Œåœ¨ç®€æ´ä¸æ€§èƒ½ä¹‹é—´æ›´å€¾å‘äºå‰è€…ã€‚ï¼‰</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token keyword">type</span><span class="token punctuation">,</span> props<span class="token punctuation">,</span> <span class="token operator">...</span>children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token keyword">type</span><span class="token punctuation">,</span>
    props<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token operator">...</span>props<span class="token punctuation">,</span>
      children<span class="token operator">:</span>children<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>child <span class="token operator">=&gt;</span>
        <span class="token keyword">typeof</span> child <span class="token operator">===</span> <span class="token string">&quot;object&quot;</span>
          <span class="token operator">?</span> child
          <span class="token operator">:</span> <span class="token function">createTextElement</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">createTextElement</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token keyword">type</span><span class="token operator">:</span> <span class="token string">&quot;TEXT_ELEMENT&quot;</span><span class="token punctuation">,</span>
    props<span class="token operator">:</span> <span class="token punctuation">{</span>
      nodeValue<span class="token operator">:</span> text<span class="token punctuation">,</span>
      children<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ç›®å‰æˆ‘ä»¬ä»ç„¶é€šè¿‡ React è¿™ä¸ªåå­—æ¥è°ƒç”¨ createElementã€‚
ä¸ºäº†æ›¿æ¢å®ƒï¼Œè®©æˆ‘ä»¬ç»™åº“å–ä¸€ä¸ªåå­—å§ã€‚æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¬èµ·æ¥åƒ Reactï¼Œä½†æ˜¯ä¹Ÿèƒ½æš—ç¤ºå…¶æ•™å­¦ç›®çš„åå­—ã€‚
æˆ‘ä»¬å¯ä»¥å«å®ƒ Didactï¼ˆåœ¨è‹±æ–‡ä¸­ï¼Œdidacticæ˜¯æ•™å­¦çš„æ„æ€ï¼‰ã€‚
const Didact = {
createElement,
}</p> <p>const element = Didact.createElement(
&quot;div&quot;,
{ id: &quot;foo&quot; },
Didact.createElement(&quot;a&quot;, null, &quot;bar&quot;),
Didact.createElement(&quot;b&quot;)
)
å¤åˆ¶ä»£ç 
ä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯å¸Œæœ›åœ¨è¿™é‡Œä½¿ç”¨ JSXã€‚é‚£æˆ‘ä»¬æ€ä¹ˆå‘Šè¯‰ babel å»ä½¿ç”¨ Didact çš„ createElement è€Œä¸æ˜¯ Reactçš„å‘¢ï¼Ÿ
å¦‚æœæˆ‘ä»¬åƒè¿™æ ·æ³¨é‡Šä¸€ä¸‹ï¼Œå½“ babel è½¬æ¢ JSX æ—¶ï¼Œå°±ä¼šä½¿ç”¨æˆ‘ä»¬å®šä¹‰çš„å‡½æ•°ã€‚
/** @jsx Didact.createElement */
const element = (
</p><div id="foo"><a>bar</a> <b></b></div>
)
å¤åˆ¶ä»£ç 
ç¬¬äºŒæ­¥ render å‡½æ•°
æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥å®ç° ReactDOM.render  å‡½æ•°ã€‚
ç°åœ¨ï¼Œæˆ‘ä»¬åªéœ€è¦å…³æ³¨å¦‚ä½•æŠŠå…ƒç´ æ”¾å…¥åˆ° DOM ä¸­ã€‚è‡³äºå¦‚ä½•å¤„ç†å…ƒç´ çš„æ›´æ–°å’Œåˆ é™¤ï¼Œæˆ‘ä»¬ä¼šåœ¨ä¹‹åè€ƒè™‘ã€‚
function render(element, container) {
// TODO create dom nodes
}
const Didact = {
createElement,
render,
}
å¤åˆ¶ä»£ç 
æˆ‘ä»¬å…ˆæ ¹æ®å…ƒç´ çš„ç±»å‹åˆ›å»ºä¸€ä¸ª DOM èŠ‚ç‚¹ï¼Œä¹‹åæŠŠè¿™ä¸ªæ–°èŠ‚ç‚¹æ·»åŠ åˆ° container å…ƒç´ ä¸­ã€‚
function render(element, container) {
const dom = document.createElement(element.type)<p></p> <p>container.appendChild(dom)
}
å¤åˆ¶ä»£ç 
æˆ‘ä»¬é€šè¿‡é€’å½’å¯¹æ¯ä¸ª child å…ƒç´ æ‰§è¡Œç›¸åŒçš„æ“ä½œã€‚
function render(element, container) {
const dom = document.createElement(element.type)</p> <p>element.props.children.forEach(child =&gt;
render(child, dom)
)</p> <p>container.appendChild(dom)
}
å¤åˆ¶ä»£ç 
æˆ‘ä»¬è¿˜éœ€è¦å¤„ç†ä¸€ä¸‹æ–‡æœ¬å…ƒç´ ï¼Œå¦‚æœå…ƒç´ çš„ç±»å‹æ˜¯ TEXT_ELEMENTï¼Œé‚£ä¹ˆå°±éœ€è¦åˆ›å»ºä¸€ä¸ªæ–‡æœ¬èŠ‚ç‚¹ã€‚
function render(element, container) {
const dom =
element.type == &quot;TEXT_ELEMENT&quot;
? document.createTextNode(&quot;&quot;)
: document.createElement(element.type)</p> <p>element.props.children.forEach(child =&gt;
render(child, dom)
)</p> <p>container.appendChild(dom)
}
å¤åˆ¶ä»£ç 
æœ€åï¼Œæˆ‘ä»¬éœ€è¦åšçš„æ˜¯ï¼Œå°†å…ƒç´  props ä¸­çš„å±æ€§æ·»åŠ åˆ° DOM èŠ‚ç‚¹ä¸Šã€‚
function render(element, container) {
const dom =
element.type == &quot;TEXT_ELEMENT&quot;
? document.createTextNode(&quot;&quot;)
: document.createElement(element.type)</p> <p>// å°†å…ƒç´  props ä¸­çš„å±æ€§æ·»åŠ åˆ° DOM èŠ‚ç‚¹ä¸Š
const isProperty = key =&gt; key !== &quot;children&quot;
Object.keys(element.props)
.filter(isProperty)
.forEach(name =&gt; {
dom[name] = element.props[name]
})</p> <p>element.props.children.forEach(child =&gt;
render(child, dom)
)</p> <p>container.appendChild(dom)
å¤åˆ¶ä»£ç 
å°±è¿™æ ·ï¼Œæˆ‘ä»¬å®ç°äº†ä¸€ä¸ªå¯ä»¥æ¸²æŸ“ JSX å…ƒç´ åˆ° DOM ä¸­çš„åº“ã€‚
function createElement(type, props, ...children) {
return {
type,
props: {
...props,
children: children.map(child =&gt;
typeof child === &quot;object&quot;
? child
: createTextElement(child)
),
},
}
}
â€‹
function createTextElement(text) {
return {
type: &quot;TEXT_ELEMENT&quot;,
props: {
nodeValue: text,
children: [],
},
}
}
â€‹
function render(element, container) {
const dom =
element.type == &quot;TEXT_ELEMENT&quot;
? document.createTextNode(&quot;&quot;)
: document.createElement(element.type)
â€‹
const isProperty = key =&gt; key !== &quot;children&quot;
Object.keys(element.props)
.filter(isProperty)
.forEach(name =&gt; {
dom[name] = element.props[name]
})
â€‹
element.props.children.forEach(child =&gt;
render(child, dom)
)
â€‹
container.appendChild(dom)
}
â€‹
const Didact = {
createElement,
render,
}
â€‹
/** @jsx Didact.createElement */
const element = (
</p><div id="foo"><a>bar</a> <b></b></div>
)
const container = document.getElementById(&quot;root&quot;)
Didact.render(element, container)
å¤åˆ¶ä»£ç 
å¤§å®¶å¯ä»¥åœ¨ codesandbox çœ‹åˆ°å®Œæ•´ä»£ç ã€‚
ç¬¬ä¸‰æ­¥ Concurrent æ¨¡å¼
ä½†æ˜¯...åœ¨æˆ‘ä»¬åŠ å…¥æ›´å¤šç‰¹æ€§ä¹‹å‰æˆ‘ä»¬éœ€è¦å¯¹ä»£ç è¿›è¡Œä¸€æ¬¡é‡æ„ã€‚
å› ä¸ºé€’å½’è°ƒç”¨ä¼šå­˜åœ¨è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼š
ä¸€æ—¦æ¸²æŸ“å¼€å§‹å°±ä¸ä¼šåœæ­¢ã€‚è®¾æƒ³ä¸€ä¸‹ï¼Œå¦‚æœæ•´ä¸ªé¡µé¢åŒ…å«éå¸¸å¤šçš„å…ƒç´ ï¼Œæ¸²æŸ“è¿‡ç¨‹ä¸­å°±ä¼šä¸€ç›´é˜»å¡ä¸»è¿›ç¨‹ã€‚å¦‚æœæ­¤æ—¶æµè§ˆå™¨æƒ³å»å¤„ç†ä¸€äº›åƒç”¨æˆ·è¾“å…¥æˆ–è€…ä¿æŒåŠ¨ç”»æµç•…è¿™äº›é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡ï¼Œå°±éœ€è¦ç­‰åˆ°æ‰€æœ‰çš„å…ƒç´ æ¸²æŸ“å®Œæˆä¹‹åå†è¿›è¡Œå¤„ç†ï¼Œè¿™å¯¹äºç”¨æˆ·æ¥è¯´æ˜¯éå¸¸ä¸å¥½çš„ä½“éªŒã€‚
æ‰€ä»¥æˆ‘ä»¬éœ€è¦åšçš„æ˜¯å°†æ•´ä¸ªä»»åŠ¡æ‹†åˆ†ä¸ºä¸€ä¸ªä¸ªå°çš„å­ä»»åŠ¡ï¼Œæµè§ˆå™¨å¯ä»¥åœ¨æ‰§è¡Œå®Œæ¯ä¸€ä¸ªå°ä»»åŠ¡ä¹‹åä¸­æ–­æ¸²æŸ“æµç¨‹è½¬è€Œå»å¤„ç†ä¸€äº›å…¶ä»–çš„äº‹æƒ…ã€‚
let nextUnitOfWork = null
â€‹
function workLoop(deadline) {
let shouldYield = false
while (nextUnitOfWork &amp;&amp; !shouldYield) {
nextUnitOfWork = performUnitOfWork(
nextUnitOfWork
)
shouldYield = deadline.timeRemaining() &lt; 1
}
requestIdleCallback(workLoop)
}
â€‹
requestIdleCallback(workLoop)
â€‹
function performUnitOfWork(nextUnitOfWork) {
// TODO
}
å¤åˆ¶ä»£ç 
æˆ‘ä»¬ä½¿ç”¨ reqeustIdleCallback æ¥åˆ›å»ºä¸€ä¸ªå¾ªç¯ä»»åŠ¡ã€‚ä½ å¯ä»¥æŠŠ requestIdleCallback ç­‰åŒäº setTimeout ã€‚åªä¸è¿‡ setTimeout éœ€è¦æˆ‘ä»¬å‘Šè¯‰å®ƒä»€ä¹ˆæ—¶å€™æ‰§è¡Œï¼Œè€Œ requestIdleCallback ä¼šåœ¨æµè§ˆå™¨ä¸»è¿›ç¨‹ç©ºé—²æ—¶æ‰§è¡Œå›è°ƒã€‚
React å¹¶æ²¡æœ‰ä½¿ç”¨ requestIdleCallback è€Œæ˜¯ä½¿ç”¨çš„è¿™ä¸ªè°ƒåº¦ç¨‹åºåŒ…ï¼Œä½†æ˜¯åœ¨æ¦‚å¿µä¸Šä¸¤è€…æ˜¯ä¸€è‡´çš„ã€‚
requestIdleCallback æä¾›äº†ä¸€ä¸ª deadline å‚æ•°ï¼Œé€šè¿‡è¿™ä¸ªå‚æ•°å¯ä»¥äº†è§£åˆ°è¿˜æœ‰å¤šå°‘æ—¶é—´æµè§ˆå™¨å°±ä¼šæ‹¿å›æ§åˆ¶æƒã€‚
æˆªæ­¢åˆ°2019å¹´11æœˆï¼ŒCocurrent æ¨¡å¼è¿˜æ˜¯ä¸ç¨³å®šçš„ã€‚å¾ªç¯çš„ç¨³å®šç‰ˆæœ¬çœ‹èµ·æ¥æ›´åƒè¿™ä¸ª:
while (nextUnitOfWork) {<br>
nextUnitOfWork = performUnitOfWork(<br>
nextUnitOfWork<br>
)
}
å¤åˆ¶ä»£ç 
å¼€å§‹ä½¿ç”¨å¾ªç¯ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®åˆå§‹å­ä»»åŠ¡ï¼Œä¹‹åéœ€è¦åˆ›å»ºä¸€ä¸ª performUnitWork å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¸ä»…è¦æ‰§è¡Œå½“å‰å­ä»»åŠ¡ï¼Œè¿˜éœ€è¦è¿”å›ä¸‹ä¸€ä¸ªè¦æ‰§è¡Œçš„å­ä»»åŠ¡ã€‚
ç¬¬å››æ­¥ Fibers
æˆ‘ä»¬ä½¿ç”¨ fiber æ ‘è¿™ç§æ•°æ®ç»“æ„æ¥è¿æ¥æ‰€æœ‰çš„å­ä»»åŠ¡ã€‚
æ¯ä¸€ä¸ªå…ƒç´ å¯¹åº”ä¸€ä¸ª fiberï¼Œæ¯ä¸€ä¸ª fiber å°±æ˜¯ä¸€ä¸ªå­ä»»åŠ¡ã€‚
è®©æˆ‘ç»™ä½ ä¸¾ä¸ªä¾‹å­ã€‚
å¦‚æœæˆ‘ä»¬æƒ³æ¸²æŸ“å¦‚ä¸‹å…ƒç´ ï¼š
Didact.render(
<div><h1><p></p> <a></a></h1> <h2></h2></div>,
container
)
å¤åˆ¶ä»£ç <p></p> <p>åœ¨ render ä¸­ï¼Œæˆ‘ä»¬ä¼šåˆ›å»ºä¸€ä¸ªæ ¹ fiberï¼Œå¹¶å°†å®ƒè®¾ç½®ä¸º nextUnitOfWorkã€‚å‰©ä¸‹çš„å·¥ä½œåˆ™ä¼šåœ¨ performUnitOfWork ä¸­è¿›è¡Œï¼Œåœ¨è¿™ä¸ªå‡½æ•°ä¸­æˆ‘ä»¬è¦ä¸ºæ¯ä¸ª fiber åšä¸‰ä»¶äº‹ï¼š</p> <p>å°†å…ƒç´ æ·»åŠ åˆ° DOM ä¸­ã€‚
ä¸ºå…ƒç´ çš„å­å…ƒç´ åˆ›å»º fiberã€‚
å¯»æ‰¾ä¸‹ä¸€ä¸ªå­ä»»åŠ¡ã€‚</p> <p>ä½¿ç”¨è¿™ä¸ªæ•°æ®ç»“æ„çš„å…¶ä¸­ä¸€ä¸ªç›®çš„å°±æ˜¯ä¸ºäº†å¯ä»¥æ›´ç®€å•çš„å¯»æ‰¾ä¸‹ä¸€ä¸ªå­ä»»åŠ¡ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ¯ä¸ª fiber éƒ½ä¼šæŒ‡å‘å®ƒçš„ç¬¬ä¸€ä¸ªå­ fiberã€ç›¸é‚»çš„å…„å¼Ÿ fiberï¼Œä»¥åŠçˆ¶ fiberã€‚
å½“æ‰§è¡Œå®Œä¸€ä¸ª fiber ä»»åŠ¡åï¼Œå¦‚æœè¿™ä¸ª fiber æœ‰ä¸€ä¸ªå­ fiberï¼Œé‚£è¿™ä¸ªå­ fiber å°±æ˜¯ä¸‹ä¸€ä¸ªè¦æ‰§è¡Œçš„å­ä»»åŠ¡ã€‚
ä¸¾ä¸ªä¾‹å­ï¼Œå½“å¤„ç†å®Œ div fiberï¼Œæ¥ä¸‹æ¥å°±ä¼šå¤„ç† h1 fiberã€‚
å¦‚æœå½“å‰ fiber æ²¡æœ‰å­ fiberï¼Œé‚£ä¹ˆå°±ä¼šæŠŠå®ƒçš„å…„å¼Ÿ fiber ä½œä¸ºä¸‹ä¸€ä¸ªè¦æ‰§è¡Œçš„å­ä»»åŠ¡ã€‚
ä¸¾ä¸ªä¾‹å­ï¼Œp fiberæ²¡æœ‰å­ fiberï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼šåœ¨å½“å‰ fiber ä»»åŠ¡ç»“æŸåå»å¤„ç† a fiberã€‚
å¦‚æœå½“å‰ fiber æ—¢æ²¡æœ‰å­ fiber ä¹Ÿæ²¡æœ‰å…„å¼Ÿ fiberã€‚å°±éœ€è¦å»åˆ°â€œå”å”â€é‚£é‡Œï¼šå…„å¼Ÿ fiber çš„çˆ¶ fiberã€‚å°±åƒä¾‹å­ä¸­çš„ a å’Œ h2 fiberã€‚
å¦‚æœçˆ¶ fiber æ²¡æœ‰å…„å¼Ÿ fiberï¼Œå°±éœ€è¦ç»§ç»§ç»­å‘ä¸Šå¯»æ‰¾ï¼Œç›´è‡³æ‰¾åˆ°æœ‰å…„å¼Ÿ fiber çš„ fiber èŠ‚ç‚¹æˆ–è€…åˆ°è¾¾æ ¹ fiberã€‚å¦‚æœåˆ°è¾¾æ ¹ fiberï¼Œå°±ä»£è¡¨å·²ç»å®Œæˆæœ¬æ¬¡æ¸²æŸ“çš„æ‰€æœ‰å·¥ä½œã€‚
ç°åœ¨ï¼Œæˆ‘ä»¬å°†ä»¥ä¸Šå¤„ç†é€»è¾‘åŠ å…¥åˆ°ä»£ç ä¸­ã€‚
é¦–å…ˆï¼Œéœ€è¦ä» render å‡½æ•°ä¸­ç§»é™¤åˆ›å»º DOM èŠ‚ç‚¹çš„ä»£ç ã€‚
æˆ‘ä»¬å°†åˆ›å»º DOM èŠ‚ç‚¹çš„é€»è¾‘å•ç‹¬æ”¾åœ¨ createDom å‡½æ•°ä¸­ï¼Œè¿™ä¸ªå‡½æ•°æˆ‘ä»¬ä¼šåœ¨ä¹‹åç”¨åˆ°ã€‚
function createDom(fiber) {
const dom =
fiber.type == &quot;TEXT_ELEMENT&quot;
? document.createTextNode(&quot;&quot;)
: document.createElement(fiber.type)
â€‹
const isProperty = key =&gt; key !== &quot;children&quot;
Object.keys(fiber.props)
.filter(isProperty)
.forEach(name =&gt; {
dom[name] = fiber.props[name]
})
â€‹
return dom
}
å¤åˆ¶ä»£ç 
åœ¨ render å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å°† fiber æ ‘çš„æ ¹èŠ‚ç‚¹èµ‹å€¼ç»™ nextUnitOfWorkã€‚
function render(element, container) {
nextUnitOfWork = {
dom: container,
props: {
children: [element],
},
}
}
â€‹
let nextUnitOfWork = null
å¤åˆ¶ä»£ç 
ä¹‹åï¼Œå¦‚æœæµè§ˆå™¨æœ‰ç©ºé—²æ—¶é—´äº†ï¼Œå°±ä¼šè°ƒç”¨æˆ‘ä»¬çš„ workLoop,ä»æ ¹èŠ‚ç‚¹å¼€å§‹å·¥ä½œã€‚
é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹å¹¶å°†å…¶æ·»åŠ åˆ°DOMä¸­ã€‚
æˆ‘ä»¬å¯ä»¥åœ¨ fiber.dom ä¸­è·å–åˆ°è¿™ä¸ª DOM èŠ‚ç‚¹ã€‚
function performUnitOfWork(fiber) {
// å°†å…ƒç´ æ·»åŠ åˆ° DOM ä¸­
if (!fiber.dom) {
fiber.dom = createDom(fiber)
}
â€‹
if (fiber.parent) {
fiber.parent.dom.appendChild(fiber.dom)
}
â€‹
// TODO ä¸ºå­å…ƒç´ åˆ›å»º fiber èŠ‚ç‚¹
// TODO è¿”å›ä¸‹ä¸€ä¸ªå­ä»»åŠ¡
}
å¤åˆ¶ä»£ç 
ä¹‹åï¼Œæˆ‘ä»¬ä¸ºæ¯ä¸€ä¸ªå­å…ƒç´ åˆ›å»ºä¸€ä¸ªæ–°çš„ fiber èŠ‚ç‚¹ã€‚
å¹¶ä¸”æ ¹æ®æ˜¯å¦æ˜¯ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹å°†å…¶ä½œä¸ºå­©å­èŠ‚ç‚¹æˆ–è€…å…„å¼ŸèŠ‚ç‚¹æ·»åŠ åˆ° fiber æ ‘ä¸­ã€‚
function performUnitOfWork(fiber) {
// å°†å…ƒç´ æ·»åŠ åˆ° DOM ä¸­
if (!fiber.dom) {
fiber.dom = createDom(fiber)
}
â€‹
if (fiber.parent) {
fiber.parent.dom.appendChild(fiber.dom)
}
â€‹
// ä¸ºå­å…ƒç´ åˆ›å»º fiber èŠ‚ç‚¹
const elements = fiber.props.children
let index = 0
let prevSibling = null
â€‹
while (index &lt; elements.length) {
const element = elements[index]
â€‹
const newFiber = {
type: element.type,
props: element.props,
parent: fiber,
dom: null,
}</p> <div class="language- extra-class"><pre><code>if (index === 0) {
  fiber.child = newFiber
} else {
  prevSibling.sibling = newFiber
}
</code></pre></div><p>â€‹
prevSibling = newFiber
index++
}</p> <p>// TODO è¿”å›ä¸‹ä¸€ä¸ªå­ä»»åŠ¡
}
å¤åˆ¶ä»£ç 
æœ€åï¼Œæˆ‘ä»¬æŒ‰ç…§å­èŠ‚ç‚¹ã€å…„å¼ŸèŠ‚ç‚¹ã€å”å”èŠ‚ç‚¹çš„é¡ºåºä¾æ¬¡ç±»æ¨ï¼Œæ¥æ‰¾åˆ°ä¸‹ä¸€ä¸ªå­ä»»åŠ¡ã€‚
function performUnitOfWork(fiber) {
// å°†å…ƒç´ æ·»åŠ åˆ° DOM ä¸­
if (!fiber.dom) {
fiber.dom = createDom(fiber)
}
â€‹
if (fiber.parent) {
fiber.parent.dom.appendChild(fiber.dom)
}
â€‹<br>
// ä¸ºå­å…ƒç´ åˆ›å»º fiber èŠ‚ç‚¹
const elements = fiber.props.children
let index = 0
let prevSibling = null
â€‹
while (index &lt; elements.length) {
const element = elements[index]
â€‹
const newFiber = {
type: element.type,
props: element.props,
parent: fiber,
dom: null,
}</p> <div class="language- extra-class"><pre><code>if (index === 0) {
  fiber.child = newFiber
} else {
  prevSibling.sibling = newFiber
}
</code></pre></div><p>â€‹
prevSibling = newFiber
index++
}</p> <p>// è¿”å›ä¸‹ä¸€ä¸ªå­ä»»åŠ¡
if (fiber.child) {
return fiber.child
}
let nextFiber = fiber
while (nextFiber) {
if (nextFiber.sibling) {
return nextFiber.sibling
}
nextFiber = nextFiber.parent
}
}
å¤åˆ¶ä»£ç 
ä»¥ä¸Šå°±æ˜¯ performUnitOfWork çš„å…¨éƒ¨é€»è¾‘ã€‚
ç¬¬äº”æ­¥ æ¸²æŸ“ä¸æäº¤é˜¶æ®µ
ç»è¿‡ä¸Šé¢ä¸€ç³»åˆ—çš„å¤„ç†ï¼Œå¦å¤–ä¸€ä¸ªé—®é¢˜å‡ºç°äº†ã€‚
æˆ‘ä»¬åœ¨å¤„ç†ä¸€ä¸ªå…ƒç´ æ—¶ä¼šä¸ºå…¶åˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹æ·»åŠ åˆ° DOM ä¸­ã€‚ä½†æ˜¯è¦è®°å¾—ï¼Œæµè§ˆå™¨æ˜¯ä¼šæ‰“æ–­æ¸²æŸ“è¿‡ç¨‹çš„ï¼Œè¿™æ ·ç”¨æˆ·å°±ä¼šçœ‹åˆ°ä¸€ä¸ªä¸å®Œæ•´çš„UIï¼Œè¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çœ‹åˆ°çš„ç»“æœã€‚
æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä» performUnitOfWork å‡½æ•°ä¸­åˆ é™¤æ·»åŠ  DOM çš„ä»£ç ã€‚
function performUnitOfWork(fiber) {
// å°†å…ƒç´ æ·»åŠ åˆ° DOM ä¸­
if (!fiber.dom) {
fiber.dom = createDom(fiber)
}
â€‹
//  åˆ é™¤æ·»åŠ  DOM çš„éƒ¨åˆ†
//  if (fiber.parent) {
//    fiber.parent.dom.appendChild(fiber.dom)
//  }
â€‹<br>
// ä¸ºå­å…ƒç´ åˆ›å»º fiber èŠ‚ç‚¹
const elements = fiber.props.children
let index = 0
let prevSibling = null
â€‹
while (index &lt; elements.length) {
const element = elements[index]
â€‹
const newFiber = {
type: element.type,
props: element.props,
parent: fiber,
dom: null,
}</p> <div class="language- extra-class"><pre><code>if (index === 0) {
  fiber.child = newFiber
} else {
  prevSibling.sibling = newFiber
}
</code></pre></div><p>â€‹
prevSibling = newFiber
index++
}</p> <p>// è¿”å›ä¸‹ä¸€ä¸ªå­ä»»åŠ¡
if (fiber.child) {
return fiber.child
}
let nextFiber = fiber
while (nextFiber) {
if (nextFiber.sibling) {
return nextFiber.sibling
}
nextFiber = nextFiber.parent
}
}
å¤åˆ¶ä»£ç 
æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªæ–°çš„å˜é‡æŒ‡å‘ fiber æ ‘çš„æ ¹èŠ‚ç‚¹ã€‚æˆ‘ä»¬å¯ä»¥å°†å…¶å‘½åä¸º work in progress rootï¼ˆæ­£åœ¨å·¥ä½œæµç¨‹ä¸­çš„æ ¹èŠ‚ç‚¹ï¼‰æˆ–è€… wipRootã€‚
function render(element, container) {
wipRoot = {
dom: container,
props: {
children: [element],
},
}
nextUnitOfWork = wipRoot
}
â€‹
let nextUnitOfWork = null
let wipRoot = null
å¤åˆ¶ä»£ç 
è¿™æ ·ï¼Œç›´åˆ°å®Œæˆæœ¬æ¬¡æ¸²æŸ“çš„å…¨éƒ¨å·¥ä½œï¼ˆæ­¤æ—¶å·²ç»æ²¡æœ‰ä¸‹ä¸€ä¸ªå­ä»»åŠ¡ï¼‰æ‰ä¼šå°†æ•´ä¸ª fiber æ ‘æäº¤åˆ° DOM ä¸­ã€‚
æˆ‘ä»¬åœ¨ commitRoot å‡½æ•°ä¸­å¤„ç†æ·»åŠ é€»è¾‘ã€‚åœ¨å‡½æ•°ä¸­é€šè¿‡é€’å½’çš„å½¢å¼å°†æ‰€æœ‰èŠ‚ç‚¹æ·»åŠ åˆ° DOM ä¸­ã€‚
function commitRoot() {
commitWork(wipRoot.child)
wipRoot = null
}
â€‹
function commitWork(fiber) {
if (!fiber) {
return
}
const domParent = fiber.parent.dom
domParent.appendChild(fiber.dom)
commitWork(fiber.child)
commitWork(fiber.sibling)
}</p> <p>function workLoop(deadline) {
let shouldYield = false
while (nextUnitOfWork &amp;&amp; !shouldYield) {
nextUnitOfWork = performUnitOfWork(
nextUnitOfWork
)
shouldYield = deadline.timeRemaining() &lt; 1
}</p> <p>â€‹ // ç›´åˆ°æ²¡æœ‰ä¸‹ä¸€ä¸ªå­ä»»åŠ¡ï¼Œå°†æ•´ä¸ª fiber æ ‘æäº¤åˆ° DOM èŠ‚ç‚¹ä¸­
if (!nextUnitOfWork &amp;&amp; wipRoot) {
commitRoot()
}
â€‹
requestIdleCallback(workLoop)
}
â€‹
requestIdleCallback(workLoop)
å¤åˆ¶ä»£ç 
ç¬¬å…­æ­¥ åè°ƒé˜¶æ®µï¼ˆReconciliationï¼‰
åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬åªæ˜¯å°†å…ƒç´ æ·»åŠ åˆ°äº† DOM ä¸­ï¼Œä½†æ˜¯æˆ‘ä»¬æ€ä¹ˆå»æ›´æ–°æˆ–è€…åˆ é™¤èŠ‚ç‚¹å‘¢ï¼Ÿ
è¿™æ­£æ˜¯æˆ‘ä»¬ç°åœ¨è¦å»åšçš„ã€‚æˆ‘ä»¬éœ€è¦å°† render å‡½æ•°ä¸­è¿”å›çš„å…ƒç´ ä¸ä¸Šä¸€æ¬¡æäº¤åˆ° DOM ä¸­çš„ fiber æ ‘è¿›è¡Œæ¯”è¾ƒã€‚
æ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨ä¸Šä¸€ä¸ª fiberæ ‘æäº¤ä¹‹åä¿å­˜å¯¹å…¶çš„å¼•ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥ç§°ä¸º currentRootã€‚
æˆ‘ä»¬è¿˜éœ€è¦åœ¨æ¯ä¸ª fiber èŠ‚ç‚¹ä¸­æ·»åŠ ä¸€ä¸ª alternate å±æ€§ã€‚è¿™ä¸ªå±æ€§ä¼šä¿å­˜ä¸Šä¸€æ¬¡æäº¤åˆ° DOM ä¸­çš„fiberèŠ‚ç‚¹ã€‚
function commitRoot() {
commitWork(wipRoot.child)
// å°† DOM æ›´æ–°ä¹‹åï¼Œæ›´æ–°å½“å‰ fiber æ ‘
currentRoot = wipRoot
wipRoot = null
}
â€‹</p> <p>function render(element, container) {
wipRoot = {
dom: container,
props: {
children: [element],
},
alternate: currentRoot,
}
nextUnitOfWork = wipRoot
}
â€‹
let nextUnitOfWork = null
// å¢åŠ  currentRoot ç”¨äºä¿å­˜å½“å‰æäº¤åˆ° DOM ä¸­çš„ fiber æ ‘
let currentRoot = null
let wipRoot = null
å¤åˆ¶ä»£ç 
ç°åœ¨ï¼Œæˆ‘ä»¬å°† performUnitOfWork ä¸­å…³äºåˆ›å»ºæ–°çš„ fiber èŠ‚ç‚¹çš„é€»è¾‘ç§»åŠ¨åˆ°ä¸€ä¸ªæ–°çš„ reconcileChildren å‡½æ•°ä¸­ã€‚
function performUnitOfWork(fiber) {
if (!fiber.dom) {
fiber.dom = createDom(fiber)
}
â€‹
const elements = fiber.props.children
// å°†åˆ›å»ºæ–°çš„ fiber èŠ‚ç‚¹çš„é€»è¾‘ç§»åŠ¨åˆ° reconcileChildren å‡½æ•°ä¸­
reconcileChildren(fiber, elements)
â€‹
if (fiber.child) {
return fiber.child
}
let nextFiber = fiber
while (nextFiber) {
if (nextFiber.sibling) {
return nextFiber.sibling
}
nextFiber = nextFiber.parent
}
}</p> <p>function reconcileChildren(wipFiber, elements) {
let index = 0
let prevSibling = null
â€‹
while (index &lt; elements.length) {
const element = elements[index]
â€‹
const newFiber = {
type: element.type,
props: element.props,
parent: wipFiber,
dom: null,
}
â€‹
if (index === 0) {
wipFiber.child = newFiber
} else {
prevSibling.sibling = newFiber
}
â€‹
prevSibling = newFiber
index++
}
}
å¤åˆ¶ä»£ç 
åœ¨ reconcileChildren å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ä¼šæŠŠæ—§çš„ fiber ä¸æ–°çš„å…ƒç´ è¿›è¡Œåè°ƒï¼ˆæ¯”è¾ƒå’Œå¤ç”¨ï¼‰ã€‚
æˆ‘ä»¬åŒæ—¶è¿­ä»£æ—§çš„ fiber çš„å­èŠ‚ç‚¹ä»¥åŠæˆ‘ä»¬æƒ³è¦åè°ƒçš„å…ƒç´ æ•°ç»„ã€‚
å¦‚æœæˆ‘ä»¬å¿½ç•¥æ‰è¿­ä»£çš„ä»£ç ï¼Œé‚£ä¹ˆåªå‰©ä¸‹æœ€é‡è¦çš„éƒ¨åˆ†ï¼šæ—§çš„ fiber å’Œå…ƒç´ ï¼Œå…ƒç´ æ˜¯æˆ‘ä»¬æƒ³è¦æ¸²æŸ“åˆ° DOM ä¸­çš„ä¸œè¥¿ï¼Œæ—§çš„ fiber æ˜¯æˆ‘ä»¬ä¸Šä¸€æ¬¡è¦æ¸²æŸ“çš„å†…å®¹ã€‚
æˆ‘ä»¬éœ€è¦å¯¹å®ƒä»¬è¿›è¡Œæ¯”è¾ƒï¼Œçœ‹çœ‹æ˜¯å¦éœ€è¦å¯¹ DOM è¿›è¡Œä»»ä½•æ›´æ”¹ã€‚
function reconcileChildren(wipFiber, elements) {
let index = 0
// è·å–æ—§çš„ fiber èŠ‚ç‚¹
let oldFiber =
wipFiber.alternate &amp;&amp; wipFiber.alternate.child
let prevSibling = null
â€‹</p> <p>while (
index &lt; elements.length ||
oldFiber != null
){
const element = elements[index]
let newFiber = null;
â€‹<br>
// TODO åœ¨è¿™é‡Œå°†æ—§çš„ fiber èŠ‚ç‚¹ä¸å…ƒç´ ä½œæ¯”è¾ƒ</p> <div class="language- extra-class"><pre><code>if(oldFiber){
    oldFiber = oldFiber.sibling;
}
</code></pre></div><p>â€‹
if (index === 0) {
wipFiber.child = newFiber
} else {
prevSibling.sibling = newFiber
}
â€‹
prevSibling = newFiber
index++
}
}
å¤åˆ¶ä»£ç 
æˆ‘ä»¬ä½¿ç”¨ type å±æ€§æ¥æ¯”è¾ƒå®ƒä»¬ï¼š</p> <p>å¦‚æœä¹‹å‰çš„ fiber èŠ‚ç‚¹å’Œæ–°çš„å…ƒç´  type å±æ€§ç›¸åŒï¼Œé‚£å°±ä¿ç•™è¿™ä¸ª DOM èŠ‚ç‚¹ï¼Œåªéœ€è¦æ›´æ–°ä¸€ä¸‹æ–°çš„ props å±æ€§ã€‚
å¦‚æœ type å±æ€§ä¸åŒï¼Œå¹¶ä¸”å­˜åœ¨æ–°çš„å…ƒç´ ï¼Œè¿™å°±æ„å‘³ç€æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ DOM èŠ‚ç‚¹ã€‚
å¦‚æœ type å±æ€§ä¸åŒï¼Œå¹¶ä¸”å­˜åœ¨æ—§çš„ fiber èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå°±éœ€è¦ç§»é™¤è¿™ä¸ªèŠ‚ç‚¹ã€‚</p> <p>*ï¼ˆä¸ºäº†åœ¨åè°ƒé˜¶æ®µå¯ä»¥æ›´å¥½çš„è¿›è¡Œæ¯”è¾ƒï¼ŒReactè¿˜åœ¨è¿™ä¸ªé˜¶æ®µä½¿ç”¨äº† key å±æ€§ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œé€šè¿‡æ·»åŠ  key å±æ€§å¯ä»¥çŸ¥é“æ•°ç»„ä¸­çš„å…ƒç´ æ˜¯å¦åªæ˜¯è°ƒæ¢äº†é¡ºåºï¼Œä»è€Œç›´æ¥å¤ç”¨ä¹‹å‰çš„èŠ‚ç‚¹ã€‚ï¼‰
function reconcileChildren(wipFiber, elements) {
let index = 0
// è·å–æ—§çš„ fiber èŠ‚ç‚¹
let oldFiber =
wipFiber.alternate &amp;&amp; wipFiber.alternate.child
let prevSibling = null
â€‹</p> <p>while (
index &lt; elements.length ||
oldFiber != null
){
const element = elements[index]
let newFiber = null;
â€‹<br>
// åœ¨è¿™é‡Œå°†æ—§çš„ fiber èŠ‚ç‚¹ä¸å…ƒç´ ä½œæ¯”è¾ƒ
const sameType =
oldFiber &amp;&amp;
element &amp;&amp;
element.type == oldFiber.type
â€‹
if (sameType) {
// TODO æ›´æ–°èŠ‚ç‚¹
}
if (element &amp;&amp; !sameType) {
// TODO æ·»åŠ èŠ‚ç‚¹
}
if (oldFiber &amp;&amp; !sameType) {
// TODO åˆ é™¤æ—§çš„ fiber ä¸­çš„èŠ‚ç‚¹
}</p> <div class="language- extra-class"><pre><code>if(oldFiber){
    oldFiber = oldFiber.sibling;
}
</code></pre></div><p>â€‹
if (index === 0) {
wipFiber.child = newFiber
} else {
prevSibling.sibling = newFiber
}
â€‹
prevSibling = newFiber
index++
}
}
å¤åˆ¶ä»£ç 
å½“æ—§çš„ fiber èŠ‚ç‚¹ä¸æ–°å…ƒç´ çš„ type å±æ€§ç›¸åŒæ—¶ï¼Œæˆ‘ä»¬åˆ›å»ºæ–°çš„ fiber èŠ‚ç‚¹æ—¶ä¼šå¤ç”¨æ—§çš„ fiber èŠ‚ç‚¹çš„ DOM å¯¹è±¡ã€‚
æˆ‘ä»¬è¿˜éœ€è¦ç»™ fiber èŠ‚ç‚¹æ·»åŠ ä¸€ä¸ª effectTag çš„å±æ€§ã€‚è¿™ä¸ªå±æ€§ä¼šåœ¨ä¹‹åçš„æäº¤é˜¶æ®µç”¨åˆ°ã€‚
if (sameType) {
// æ›´æ–°èŠ‚ç‚¹
newFiber = {
type: oldFiber.type,
props: element.props,
dom: oldFiber.dom,
parent: wipFiber,
alternate: oldFiber,
effectTag: &quot;UPDATE&quot;,
}
}
å¤åˆ¶ä»£ç 
åœ¨å½“å‰è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœå…ƒç´ éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ DOM èŠ‚ç‚¹ï¼Œå°±éœ€è¦å°†fiberçš„ effectTag å±æ€§æ ‡è®°ä¸º PLACEMENTã€‚
if (element &amp;&amp; !sameType) {
//  æ·»åŠ èŠ‚ç‚¹
newFiber = {
type: element.type,
props: element.props,
dom: null,
parent: wipFiber,
alternate: null,
effectTag: &quot;PLACEMENT&quot;,
}
}
å¤åˆ¶ä»£ç 
å¦‚æœå½“å‰å…ƒç´ éœ€è¦è¢«åˆ é™¤ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ fiber èŠ‚ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†æ—§çš„ fiber èŠ‚ç‚¹çš„ effectTag å±æ€§æ ‡è®°ä¸º DELETIONã€‚
if (oldFiber &amp;&amp; !sameType) {
// åˆ é™¤æ—§çš„ fiber ä¸­çš„èŠ‚ç‚¹
oldFiber.effectTag = &quot;DELETION&quot;
deletions.push(oldFiber) // deletions å“ªæ¥çš„ï¼Ÿæˆ‘ä»¬æ¥é©¬ä¸Šåˆ†è§£ä¸€ä¸‹
}
å¤åˆ¶ä»£ç 
ä½†æ˜¯å½“æˆ‘ä»¬å°† wipRoot æŒ‡å‘çš„è¿™ä¸ª fiber æ ‘æäº¤åˆ° DOM ä¸­æ—¶æ˜¯ä¸åŒ…å«è¿™ä¸ªæ—§çš„ fiber èŠ‚ç‚¹ã€‚
æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ•°ç»„ç”¨æ¥å­˜å‚¨éœ€è¦è¢«åˆ é™¤çš„ fiber èŠ‚ç‚¹ã€‚
function render(element, container) {
wipRoot = {
dom: container,
props: {
children: [element],
},
alternate: currentRoot,
}
deletions = [] // æ–°å¢
nextUnitOfWork = wipRoot
}
â€‹
let nextUnitOfWork = null
let currentRoot = null
let wipRoot = null
// æ–°å¢ deletions ç”¨æ¥å­˜å‚¨è¦åˆ é™¤çš„ fiber èŠ‚ç‚¹
let deletions = null
å¤åˆ¶ä»£ç 
è¿™æ ·åœ¨æˆ‘ä»¬å°†æ”¹å˜æäº¤åˆ° DOM çš„æ—¶å€™ï¼Œå°±å¯ä»¥é€šè¿‡è¿™ä¸ªæ•°ç»„åˆ é™¤ä¸å†éœ€è¦çš„ DOM èŠ‚ç‚¹ã€‚
function commitRoot() {
deletions.forEach(commitWork) //
commitWork(wipRoot.child)
currentRoot = wipRoot
wipRoot = null
}
å¤åˆ¶ä»£ç 
ç°åœ¨ï¼Œè®©æˆ‘ä»¬åœ¨ commitWork å‡½æ•°é‡Œé¢æ ¹æ®æ–°åŠ å…¥çš„ effectTags å±æ€§åšä¸€äº›å¤„ç†ã€‚
å¦‚æœ fiber èŠ‚ç‚¹çš„ effectTag çš„å±æ€§ä¸º PLACEMENTï¼Œæˆ‘ä»¬åªéœ€è¦åƒä¹‹å‰é‚£æ ·å°† DOM èŠ‚ç‚¹æ”¾å…¥åˆ°çˆ¶ fiber å¯¹åº”çš„ DOM èŠ‚ç‚¹ä¸­ã€‚
å¦‚æœå±æ€§ä¸º DELETIONï¼Œåˆ™ä¸å‰ä¸€æ­¥ç›¸åï¼Œæˆ‘ä»¬å°±éœ€è¦ç§»é™¤è¿™ä¸ª DOM èŠ‚ç‚¹ã€‚
å¦‚æœå±æ€§ä¸º UPDATEï¼Œæˆ‘ä»¬å°±éœ€è¦æ ¹æ® props å±æ€§çš„æ”¹å˜æ¥æ›´æ–°å·²ç»å­˜åœ¨çš„ DOM èŠ‚ç‚¹ã€‚
function commitWork(fiber) {
if (!fiber) {
return
}
const domParent = fiber.parent.dom
// å°†æ–°èŠ‚ç‚¹æ·»åŠ åˆ° DOM ä¸­
if (
fiber.effectTag === &quot;PLACEMENT&quot; &amp;&amp;
fiber.dom != null
) {
domParent.appendChild(fiber.dom)
}
// æ›´æ–°èŠ‚ç‚¹
else if (
fiber.effectTag === &quot;UPDATE&quot; &amp;&amp;
fiber.dom != null
) {
// updateDom åˆåœ¨å“ªï¼Ÿå‘µå‘µï¼Œç»§ç»­å¾€ä¸‹çœ‹å§
updateDom(
fiber.dom,
fiber.alternate.props,
fiber.props
)
}
// åˆ é™¤èŠ‚ç‚¹
else if (fiber.effectTag === &quot;DELETION&quot;) {
domParent.removeChild(fiber.dom)
}
â€‹
commitWork(fiber.child)
commitWork(fiber.sibling)
}
å¤åˆ¶ä»£ç 
æˆ‘ä»¬åœ¨ updateDom å‡½æ•°ä¸­æ¥å¤„ç†æ›´æ–° DOM çš„é€»è¾‘ã€‚
æˆ‘ä»¬æ¯”è¾ƒæ—§çš„ fiber èŠ‚ç‚¹ä¸æ–°çš„ fiber èŠ‚ç‚¹ä¹‹é—´çš„ props å±æ€§çš„å·®å¼‚ï¼Œåˆ é™¤ä¸å­˜åœ¨çš„å±æ€§ï¼Œè®¾ç½®æ–°çš„å±æ€§ï¼Œä»¥åŠæ›´æ–°æ”¹å˜çš„å±æ€§ã€‚
const isProperty = key =&gt; key !== &quot;children&quot;
const isNew = (prev, next) =&gt; key =&gt;
prev[key] !== next[key]
const isGone = (prev, next) =&gt; key =&gt; !(key in next)</p> <p>function updateDom(dom, prevProps, nextProps) {
// åˆ é™¤ä¸å†éœ€è¦çš„å±æ€§
Object.keys(prevProps)
.filter(isProperty)
.filter(isGone(prevProps, nextProps))
.forEach(name =&gt; {
dom[name] = &quot;&quot;
})
â€‹
// æ›´æ–°æˆ–è€…è®¾ç½®æ–°çš„å±æ€§
Object.keys(nextProps)
.filter(isProperty)
.filter(isNew(prevProps, nextProps))
.forEach(name =&gt; {
dom[name] = nextProps[name]
})
}
å¤åˆ¶ä»£ç 
é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜è¦å¯¹äº‹ä»¶ç›‘å¬è¿™ä¸ªç‰¹æ®Šçš„ porps å±æ€§è¿›è¡Œç‰¹æ®Šå¤„ç†ã€‚æ‰€ä»¥å¦‚æœ prop çš„å±æ€§åæ˜¯ä»¥ â€œonâ€ ä¸ºå‰ç¼€ï¼Œæˆ‘ä»¬å°±éœ€è¦å¯¹å…¶è¿›è¡Œå·®å¼‚å¤„ç†ã€‚
å¦‚æœäº‹ä»¶å¤„ç†å‡½æ•°å‘ç”Ÿæ”¹å˜ï¼Œæˆ‘ä»¬å°±ä»èŠ‚ç‚¹ä¸Šå°†è¿™ä¸ªäº‹ä»¶ç›‘å¬ç§»é™¤ã€‚
ä¹‹åæˆ‘ä»¬å†æ·»åŠ æ–°çš„äº‹ä»¶å¤„ç†å‡½æ•°ã€‚
const isEvent = key =&gt; key.startsWith(&quot;on&quot;)
const isProperty = key =&gt;
key !== &quot;children&quot; &amp;&amp; !isEvent(key)</p> <p>const isProperty = key =&gt; key !== &quot;children&quot;
const isNew = (prev, next) =&gt; key =&gt;
prev[key] !== next[key]
const isGone = (prev, next) =&gt; key =&gt; !(key in next)</p> <p>function updateDom(dom, prevProps, nextProps) {
// åˆ é™¤æ—§çš„äº‹ä»¶ç›‘å¬
Object.keys(prevProps)
.filter(isEvent)
.filter(
key =&gt;
!(key in nextProps) ||
isNew(prevProps, nextProps)(key)
)
.forEach(name =&gt; {
const eventType = name
.toLowerCase()
.substring(2)
dom.removeEventListener(
eventType,
prevProps[name]
)
})</p> <p>// åˆ é™¤ä¸å†éœ€è¦çš„å±æ€§
Object.keys(prevProps)
.filter(isProperty)
.filter(isGone(prevProps, nextProps))
.forEach(name =&gt; {
dom[name] = &quot;&quot;
})
â€‹
// æ›´æ–°æˆ–è€…è®¾ç½®æ–°çš„å±æ€§
Object.keys(nextProps)
.filter(isProperty)
.filter(isNew(prevProps, nextProps))
.forEach(name =&gt; {
dom[name] = nextProps[name]
})</p> <p>// æ·»åŠ æ–°çš„äº‹ä»¶ç›‘å¬
Object.keys(nextProps)
.filter(isEvent)
.filter(isNew(prevProps, nextProps))
.forEach(name =&gt; {
const eventType = name
.toLowerCase()
.substring(2)
dom.addEventListener(
eventType,
nextProps[name]
)
})
}
å¤åˆ¶ä»£ç 
å¤§å®¶å¯ä»¥åœ¨codesandboxæµè§ˆæ·»åŠ äº†åè°ƒæœºåˆ¶çš„ä»£ç ç‰ˆæœ¬ã€‚
ç¬¬ä¸ƒæ­¥ å‡½æ•°ç»„ä»¶
æ¥ä¸‹æ¥æˆ‘ä»¬è¦åšçš„äº‹æƒ…å°±æ˜¯å¢åŠ å¯¹å‡½æ•°ç»„ä»¶çš„æ”¯æŒã€‚
é¦–å…ˆï¼Œéœ€è¦æ›´æ¢ä¸€ä¸‹ä¾‹å­ã€‚æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç®€å•çš„å‡½æ•°ç»„ä»¶ï¼Œè¿™ä¸ªç»„ä»¶ä¼šè¿”å›ä¸€ä¸ª h1 å…ƒç´ ã€‚
/** @jsx Didact.createElement */
function App(props) {
return </p><h1>Hi {props.name}</h1>
}
const element = <App name="foo"></App>
const container = document.getElementById(&quot;root&quot;)
Didact.render(element, container)
å¤åˆ¶ä»£ç 
è¯·æ³¨æ„ï¼Œå¦‚æœä»¬å°† jsx è½¬æ¢ä¸º é‚£ä¹ˆå°†ä¼šæ˜¯ä¸‹é¢è¿™ä¸ªæ ·å­ï¼š
function App(props) {
return Didact.createElement(
&quot;h1&quot;,
null,
&quot;Hi &quot;,
props.name
)
}
const element = Didact.createElement(App, {
name: &quot;foo&quot;,
})
å¤åˆ¶ä»£ç 
å‡½æ•°ç»„ä»¶æœ‰ä¸¤ä¸ªæ–¹é¢çš„ä¸åŒï¼š<p></p> <p>ä»£è¡¨å‡½æ•°ç»„ä»¶çš„ fiber èŠ‚ç‚¹æ˜¯æ²¡æœ‰ DOM èŠ‚ç‚¹çš„
å­èŠ‚ç‚¹æ˜¯éœ€è¦è¿è¡Œå‡½æ•°è€Œä¸æ˜¯ç›´æ¥ ä» props å±æ€§ä¸­å¾—åˆ°çš„</p> <p>å¦‚æœåˆ¤æ–­è¿™ä¸ª fiber çš„ type å±æ€§æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬åˆ™éœ€è¦ä¸€ä¸ªä¸åŒçš„æ›´æ–°å‡½æ•°æ¥å¤„ç†å®ƒã€‚
function performUnitOfWork(fiber) {
// åˆ¤æ–­æ˜¯ä¸æ˜¯å‡½æ•°ç»„ä»¶ï¼Œå¦‚æœæ˜¯ï¼Œå°±é’ˆå¯¹å…¶è¿›è¡Œç‰¹æ®Šå¤„ç†
const isFunctionComponent =
fiber.type instanceof Function
if (isFunctionComponent) {
updateFunctionComponent(fiber)
} else {
updateHostComponent(fiber)
â€‹<br>
// ä¸ºå­å…ƒç´ åˆ›å»º fiber èŠ‚ç‚¹
const elements = fiber.props.children
let index = 0
let prevSibling = null
â€‹
while (index &lt; elements.length) {
const element = elements[index]
â€‹
const newFiber = {
type: element.type,
props: element.props,
parent: fiber,
dom: null,
}</p> <div class="language- extra-class"><pre><code>if (index === 0) {
  fiber.child = newFiber
} else {
  prevSibling.sibling = newFiber
}
</code></pre></div><p>â€‹
prevSibling = newFiber
index++
}</p> <p>// è¿”å›ä¸‹ä¸€ä¸ªå­ä»»åŠ¡
if (fiber.child) {
return fiber.child
}
let nextFiber = fiber
while (nextFiber) {
if (nextFiber.sibling) {
return nextFiber.sibling
}
nextFiber = nextFiber.parent
}
}</p> <p>â€‹
function updateFunctionComponent(fiber) {
// TODO
}
â€‹
function updateHostComponent(fiber) {
if (!fiber.dom) {
fiber.dom = createDom(fiber)
}
reconcileChildren(fiber, fiber.props.children)
}
å¤åˆ¶ä»£ç 
åœ¨ updateHostComponent ä¸­æˆ‘ä»¬ç»§ç»­æ²¿ç”¨ä¹‹å‰é€»è¾‘ã€‚
åœ¨ updateFunctionComponent å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬éœ€è¦è°ƒç”¨å‡½æ•°ï¼ˆfiber.typeï¼‰æ¥è·å– children å…ƒç´ ã€‚
åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œ fiber.type å±æ€§å°±æ˜¯ App è¿™ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬è°ƒç”¨å®ƒï¼Œä¼šè¿”å›ä¸€ä¸ª h1 å…ƒç´ ã€‚
åªè¦æˆ‘ä»¬æ‹¿åˆ°äº†å­èŠ‚ç‚¹ï¼Œä¹‹åçš„åè°ƒé˜¶æ®µä¹Ÿæ˜¯å’Œä¹‹å‰ä¸€æ ·çš„ï¼Œæ²¡æœ‰ä»€ä¹ˆæ”¹å˜ã€‚
function updateFunctionComponent(fiber) {
const children = [fiber.type(fiber.props)]
reconcileChildren(fiber, children)
}
å¤åˆ¶ä»£ç 
æˆ‘ä»¬éœ€è¦æ”¹å˜çš„æ˜¯ commitWork å‡½æ•°ã€‚
function commitWork(fiber) {
if (!fiber) {
return
}
â€‹
const domParent = fiber.parent.dom
if (
fiber.effectTag === &quot;PLACEMENT&quot; &amp;&amp;
fiber.dom != null
) {
domParent.appendChild(fiber.dom)
} else if (
fiber.effectTag === &quot;UPDATE&quot; &amp;&amp;
fiber.dom != null
) {
updateDom(
fiber.dom,
fiber.alternate.props,
fiber.props
)
} else if (fiber.effectTag === &quot;DELETION&quot;) {
domParent.removeChild(fiber.dom)
}
â€‹
commitWork(fiber.child)
commitWork(fiber.sibling)
}
å¤åˆ¶ä»£ç 
ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦é’ˆå¯¹ä¸åŒ…å« DOM çš„ fiber èŠ‚ç‚¹åšä¸¤å¤„æ”¹åŠ¨ã€‚
é¦–å…ˆï¼Œè¦æ‰¾åˆ°ä¸€ä¸ª DOM èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦æ²¿ç€ fiber æ ‘å‘ä¸Šå¯»æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªåŒ…å« DOM èŠ‚ç‚¹çš„fiberã€‚
function commitWork(fiber) {
if (!fiber) {
return
}</p> <p>// å¯»æ‰¾ DOM èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹
let domParentFiber = fiber.parent
while (!domParentFiber.dom) {
domParentFiber = domParentFiber.parent
}
const domParent = domParentFiber.dom
â€‹
if (
fiber.effectTag === &quot;PLACEMENT&quot; &amp;&amp;
fiber.dom != null
) {
domParent.appendChild(fiber.dom)
} else if (
fiber.effectTag === &quot;UPDATE&quot; &amp;&amp;
fiber.dom != null
) {
updateDom(
fiber.dom,
fiber.alternate.props,
fiber.props
)
} else if (fiber.effectTag === &quot;DELETION&quot;) {
domParent.removeChild(fiber.dom)
}
â€‹
commitWork(fiber.child)
commitWork(fiber.sibling)
}
å¤åˆ¶ä»£ç 
å½“éœ€è¦ç§»é™¤ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦æŒç»­å¯»æ‰¾ç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªåŒ…å« DOM èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ã€‚
function commitWork(fiber) {
if (!fiber) {
return
}</p> <p>let domParentFiber = fiber.parent
while (!domParentFiber.dom) {
domParentFiber = domParentFiber.parent
}
const domParent = domParentFiber.dom
â€‹
if (
fiber.effectTag === &quot;PLACEMENT&quot; &amp;&amp;
fiber.dom != null
) {
domParent.appendChild(fiber.dom)
} else if (
fiber.effectTag === &quot;UPDATE&quot; &amp;&amp;
fiber.dom != null
) {
updateDom(
fiber.dom,
fiber.alternate.props,
fiber.props
)
} else if (fiber.effectTag === &quot;DELETION&quot;) {
// é€šè¿‡ commitDelection é€’å½’ç›´åˆ°æ‰¾åˆ°å­èŠ‚ç‚¹
commitDeletion(fiber,domParent);
}
â€‹
commitWork(fiber.child)
commitWork(fiber.sibling)
}</p> <p>function commitDeletion(fiber, domParent) {
if (fiber.dom) {
domParent.removeChild(fiber.dom)
} else {
commitDeletion(fiber.child, domParent)
}
}
å¤åˆ¶ä»£ç 
ç¬¬å…«æ­¥ Hooks
æœ€åä¸€æ­¥ï¼Œæ—¢ç„¶æˆ‘ä»¬ä½¿ç”¨äº†å‡½æ•°ç»„ä»¶ï¼Œå½“ç„¶ä¹Ÿè¦ç»™å®ƒåŠ ä¸ŠçŠ¶æ€ã€‚
è®©æˆ‘ä»¬å°†ä¾‹å­æ›¿æ¢ä¸ºä¸€ä¸ªç»å…¸çš„è®¡ç®—ç»„ä»¶ï¼Œå½“æˆ‘ä»¬æ¯æ¬¡ç‚¹å‡»å®ƒï¼Œç»„ä»¶ä¸­çš„å€¼åŠ 1ã€‚
æ³¨æ„ï¼Œæˆ‘ä»¬ä½¿ç”¨ Didact.useState æ¥è·å–å’Œæ›´æ–°è¿™ä¸ªè®¡ç®—å€¼ã€‚
const Didact = {
createElement,
render,
useState,
}
â€‹
/** @jsx Didact.createElement */
function Counter() {
// ä½¿ç”¨ Didact.useState åœ¨å‡½æ•°ç»„ä»¶å†…åˆ›å»ºçŠ¶æ€ï¼ˆuseStateæˆ‘ä»¬ä¼šåœ¨ç¨åå®ç°ï¼‰
const [state, setState] = Didact.useState(1)
return (
&lt;h1 onClick={() =&gt; setState(c =&gt; c + 1)}&gt;
Count: {state}

)
}
const element = <Counter></Counter>
const container = document.getElementById(&quot;root&quot;)
Didact.render(element, container)
å¤åˆ¶ä»£ç 
åœ¨ useState å‡½æ•°ä¸­ï¼Œä¼šå­˜å‚¨ä»¥åŠæ›´æ–°ç»„ä»¶çš„çŠ¶æ€ã€‚
function updateFunctionComponent(fiber) {
const children = [fiber.type(fiber.props)]
reconcileChildren(fiber, children)
}
â€‹
function useState(initial) {
// TODO
}
å¤åˆ¶ä»£ç 
åœ¨è°ƒç”¨å‡½æ•°ç»„ä»¶ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å£°æ˜ä¸€äº›å…¨å±€å˜é‡ä»¥ä¾›åœ¨ useState å‡½æ•°ä¸­ä½¿ç”¨ã€‚
é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª wipFiber å˜é‡ï¼ˆ wip å³æ˜¯ work in progressï¼Œè¡¨ç¤ºå‚ä¸æœ¬æ¬¡æ¸²æŸ“å·¥ä½œçš„ fiber èŠ‚ç‚¹ï¼‰ã€‚
æˆ‘ä»¬è¿˜éœ€è¦åœ¨ fiber èŠ‚ç‚¹ä¸­æ·»åŠ ä¸€ä¸ª hooks æ•°ç»„ï¼Œä»¥æ”¯æŒåœ¨åŒä¸€ä¸ªç»„ä»¶ä¸­å¤šæ¬¡è°ƒç”¨ useState æ–¹æ³•ã€‚å¹¶ä¸”æˆ‘ä»¬è¿˜éœ€è¦å¯¹å½“å‰ hook çš„ç´¢å¼•è¿›è¡Œè®°å½•ã€‚
let wipFiber = null
let hookIndex = null
â€‹
function updateFunctionComponent(fiber) {
wipFiber = fiber
hookIndex = 0
wipFiber.hooks = []
const children = [fiber.type(fiber.props)]
reconcileChildren(fiber, children)
}
â€‹
function useState(initial) {
// TODO
}
å¤åˆ¶ä»£ç 
å½“åœ¨å‡½æ•°ç»„ä»¶ä¸­è°ƒç”¨ useState æ—¶ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ fiber çš„ alternate å±æ€§ä»¥åŠ hook çš„ç´¢å¼•æ¥æŸ¥çœ‹æ˜¯å¦å­˜åœ¨æ—§çš„ hookã€‚
å¦‚æœå­˜åœ¨æ—§çš„ hookï¼Œæˆ‘ä»¬åˆ™ä»æ—§çš„ hook ä¸­æ‹·è´è¿™ä¸ªçŠ¶æ€åˆ°æ–°çš„ hookï¼Œå¦‚æœä¸å­˜åœ¨æˆ‘ä»¬å°±ä½¿ç”¨åˆå§‹å€¼å¯¹ hook çš„çŠ¶æ€è¿›è¡Œåˆå§‹åŒ–ã€‚
ä¹‹åæˆ‘ä»¬å°†æ–°çš„ hook æ·»åŠ åˆ° fiber èŠ‚ç‚¹ä¸Šï¼Œå¢åŠ  hook çš„ç´¢å¼•å€¼ï¼ˆæŒ‡å‘ä¸‹ä¸€ä¸ªhookï¼‰ï¼Œä¹‹åè¿”å›å¤„ç†å¥½çš„çŠ¶æ€ï¼ˆåœ¨ä¾‹å­ä¸­å³æ˜¯è®¡ç®—å¥½çš„æ•°å€¼ï¼‰ã€‚
function useState(initial) {
const oldHook =
wipFiber.alternate &amp;&amp;
wipFiber.alternate.hooks &amp;&amp;
wipFiber.alternate.hooks[hookIndex]
const hook = {
state: oldHook ? oldHook.state : initial,
}
â€‹
wipFiber.hooks.push(hook)
hookIndex++
return [hook.state]
}
å¤åˆ¶ä»£ç 
å¹¶ä¸” useState è¿˜è¿”å›äº†ä¸€ä¸ªç”¨äºæ›´æ–°çŠ¶æ€çš„å‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªæ¥æ”¶actionï¼ˆåœ¨å½“å‰ä¾‹å­ä¸­ï¼Œactionå°±æ˜¯å¯¹å€¼è¿›è¡ŒåŠ 1çš„å‡½æ•°ï¼‰ä½œä¸ºå‚æ•°çš„ setState å‡½æ•°ã€‚
æˆ‘ä»¬éœ€è¦å°† action æ·»åŠ åˆ° hook çš„ queue æ•°ç»„ä¸­ã€‚
ä¹‹åæˆ‘ä»¬éœ€è¦åšä¸€ä¸ªä¸ render å‡½æ•°ä¸­ç›¸ä¼¼çš„æ“ä½œï¼Œä¸º wipRoot èµ‹å€¼ä¸€ä¸ªæ–°çš„ fiber ä½œä¸ºä¸‹ä¸€ä¸ªä»»åŠ¡ï¼Œè¿™æ · workLoop å°±ä¼šå¼€å§‹ä¸€ä¸ªæ–°çš„æ¸²æŸ“é˜¶æ®µã€‚
ä½†æ˜¯æˆ‘ä»¬æ­¤æ—¶è¿˜æ²¡æœ‰å¤„ç† action å‡½æ•°ã€‚
åœ¨ä¸‹ä¸€æ¬¡æ¸²æŸ“ç»„ä»¶çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä»æ—§çš„ hook ä¸­æ‹¿åˆ°æ‰€æœ‰çš„ actionï¼Œå¹¶ä½¿ç”¨è¿™äº›actionå¯¹stateè¿›è¡Œå¤„ç†ï¼Œå› æ­¤å½“æˆ‘ä»¬è¿”å›çŠ¶æ€æ—¶ï¼Œå€¼ä¼šè¢«æ›´æ–°ã€‚
function useState(initial) {
const oldHook =
wipFiber.alternate &amp;&amp;
wipFiber.alternate.hooks &amp;&amp;
wipFiber.alternate.hooks[hookIndex]</p> <p>const hook = {
state: oldHook ? oldHook.state : initial,
// å°† actionï¼ˆå³æ›´æ–°çŠ¶æ€çš„å‡½æ•°ï¼‰æ·»åŠ åˆ° queue æ•°ç»„ä¸­
queue:[]
}</p> <p>// æ‹¿åˆ° action å¯¹ state è¿›è¡Œå¤„ç†
const actions = oldHook ? oldHook.queue : []
actions.forEach(action =&gt; {
hook.state = action(hook.state)
})</p> <p>// setState å°† action æ·»åŠ åˆ° hook çš„ queue ä¸­ï¼Œåˆ›å»ºå­ä»»åŠ¡è¿™æ ·å°±ä¼šé‡æ–°è¿›è¡Œæ¸²æŸ“é¡µé¢
â€‹ const setState = action =&gt; {
hook.queue.push(action)
wipRoot = {
dom: currentRoot.dom,
props: currentRoot.props,
alternate: currentRoot,
}
nextUnitOfWork = wipRoot
deletions = []
}</p> <p>wipFiber.hooks.push(hook)
hookIndex++</p> <p>// å°† state å’Œ setState æš´éœ²å‡ºå»
return [hook.state,setState]
}
å¤åˆ¶ä»£ç 
å°±è¿™æ ·ï¼Œæˆ‘ä»¬æ„å»ºå‡ºäº†æˆ‘ä»¬è‡ªå·±çš„ Reactã€‚
ä½ å¯ä»¥åœ¨ codesandbox æˆ–è€… github ä¸­çœ‹åˆ°å®Œæ•´çš„æºç ã€‚
æ€»ç»“
é™¤äº†å¸®åŠ©ä½ ç†è§£ React æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œæœ¬æ–‡çš„å…¶ä¸­ä¸€ä¸ªç›®æ ‡æ˜¯å¯ä»¥è®©ä½ æ›´å®¹æ˜“æ·±å…¥äº†è§£ React çš„ä»£ç åº“ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å‡ ä¹åœ¨æ‰€æœ‰åœ°æ–¹éƒ½ä½¿ç”¨ä¸ React ç›¸åŒçš„å˜é‡ä»¥åŠå‡½æ•°åã€‚
ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœä½ åœ¨ä»»ä½•ä¸€ä¸ªçœŸå®çš„ React åº”ç”¨çš„å‡½æ•°ç»„ä»¶ä¸­æ·»åŠ ä¸€ä¸ªæ–­ç‚¹ï¼Œé‚£ä¹ˆè°ƒç”¨å †æ ˆå°±ä¼šæ˜¾ç¤ºç»™ä½ å¦‚ä¸‹ä¿¡æ¯ï¼š</p> <p>workLoop
performUnitOfWork
updateFunctionComponent</p> <p>æˆ‘ä»¬å®ç°çš„ä»£ç å¹¶æ²¡æœ‰åŒ…å«å¾ˆå¤šçš„ React ç‰¹æ€§ä»¥åŠä¼˜åŒ–ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä»¥ä¸‹æ˜¯ React ä¸æˆ‘ä»¬çš„å®ç°åšçš„ä¸åŒçš„åœ°æ–¹ï¼š</p> <p>åœ¨ Didact ä¸­ï¼Œæ¸²æŸ“é˜¶æ®µä¼šéå†æ•´ä¸ªæ ‘ã€‚React åˆ™ä¼šé€šè¿‡ä¸€äº›æœºåˆ¶è·³è¿‡é‚£äº›æ²¡æœ‰å‘ç”Ÿæ”¹å˜çš„å­æ ‘ã€‚
æˆ‘ä»¬è¿˜ä¼šåœ¨æäº¤é˜¶æ®µéå†æ•´ä¸ªæ ‘ï¼ŒReact åˆ™åªä¼šä¿ç•™äº§ç”Ÿå½±å“çš„ fiber èŠ‚ç‚¹é“¾è¡¨ã€‚
æ¯æ¬¡æˆ‘ä»¬æ„å»ºä¸€ä¸ªæ–°çš„æ ‘æ—¶ï¼Œæˆ‘ä»¬ä¼šä¸ºæ¯ä¸ª fiber åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚ä½†æ˜¯ React ä¼šå¤ç”¨ä¹‹å‰æ ‘ä¸Šçš„ fiber èŠ‚ç‚¹ã€‚
å½“ Didact åœ¨æ¸²æŸ“é˜¶æ®µæ”¶åˆ°ä¸€ä¸ªæ–°çš„æ›´æ–°æ—¶ï¼Œä¼šä¸¢å¼ƒä¹‹å‰çš„å·¥ä½œæ ‘ï¼Œä»æ ¹èŠ‚ç‚¹é‡æ–°å¼€å§‹ã€‚ä½†æ˜¯ React ä¼šç»™æ¯ä¸€ä¸ªæ›´æ–°æ ‡è®°ä¸€ä¸ªè¿‡æœŸæ—¶é—´æˆ³ï¼Œé€šè¿‡è¿™ä¸ªæ—¶é—´æˆ³æ¥å†³å®šå„æ›´æ–°ä¹‹é—´çš„ä¼˜å…ˆçº§ã€‚
é™¤æ­¤ä¹‹å¤–è¿˜æœ‰å¾ˆå¤š...</p> <p>è¿™é‡Œè¿˜æœ‰ä¸€äº›ä½ å¯ä»¥æ¯”è¾ƒç®€å•æ·»åŠ çš„ç‰¹æ€§ï¼š</p> <p>åœ¨ props ä¸­æ·»åŠ æ ·å¼å¯¹è±¡å±æ€§ï¼ˆå³ style å±æ€§ï¼‰
æ‰å¹³åŒ–å­å…ƒç´ æ•°ç»„
useEffect hook
å°† key æœºåˆ¶å¼•å…¥åˆ°åè°ƒæœºåˆ¶ä¸­</p> <p>å¦‚æœä½ åœ¨ Didact ä¸­åŠ å…¥äº†ä»¥ä¸Šä»»ä½•ä¸€ä¸ªç‰¹æ€§æˆ–è€…å…¶ä»–çš„ç‰¹æ€§ï¼Œä½ å¯ä»¥æä¸€ä¸ª PR åˆ°è¿™ä¸ª Github ä»“åº“ï¼Œè¿™æ ·å°±å¯ä»¥è®©å…¶ä»–äººçœ‹åˆ°äº†ã€‚
æ„Ÿè°¢é˜…è¯»ã€‚
æœ€åï¼Œé™„ä¸ŠåŸæ–‡åœ°å€ã€‚</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/xieyezi/vuepress-blog/edit/master/front-end/å¦‚ä½•æ„å»ºä½ è‡ªå·±çš„React.md" target="_blank" rel="noopener noreferrer">å¸®åŠ©æˆ‘æ”¹å–„è¿™ä¸ªé¡µé¢</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">æœ€åæ›´æ–°æ—¶é—´:</span> <span class="time">9/24/2020, 8:48:49 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/front-end/vuex5è¦è§£å†³å“ªäº›é—®é¢˜.html" class="prev"><i aria-label="icon: left" class="anticon anticon-left"><svg viewBox="64 64 896 896" focusable="false" data-icon="left" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8a31.86 31.86 0 0 0 0 50.3l450.8 352.1c5.3 4.1 12.9.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281 360-281.1c3.8-3 6.1-7.7 6.1-12.6z"></path></svg></i>
        vuex5è¦è§£å†³å“ªäº›é—®é¢˜
      </a></span> <span class="next"><a href="/front-end/å•†å“å¤šè§„æ ¼é€‰æ‹©-skuç®—æ³•.html">
        å•†å“å¤šè§„æ ¼é€‰æ‹©-skuç®—æ³•
        <i aria-label="icon: right" class="anticon anticon-right"><svg viewBox="64 64 896 896" focusable="false" data-icon="right" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M765.7 486.8L314.9 134.7A7.97 7.97 0 0 0 302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 0 0 0-50.4z"></path></svg></i></a></span></p></div> </main> <!----></div><div class="global-ui"><canvas id="vuepress-canvas-cursor"></canvas><!----><div id="goTop" class="hide-cat" data-v-a11242f6></div></div></div>
    <script src="/assets/js/app.c36f292d.js" defer></script><script src="/assets/js/3.38912bee.js" defer></script><script src="/assets/js/44.dbdc6ded.js" defer></script>
  </body>
</html>